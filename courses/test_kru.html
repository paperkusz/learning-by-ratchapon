<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการข้อสอบ | โรงเรียนพรตพิทยพยัต</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* CSS เหมือนเดิม (ทั้งหมด) */
        /* ... โค้ด CSS ทั้งหมดเหมือนเดิม ... */
    </style>
</head>
<body>
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-container">
            <h1><i class="fas fa-user-shield"></i> ระบบจัดการข้อสอบ Arduino</h1>
            <div class="admin-nav">
                <button class="nav-btn active" onclick="showSection('questions')">
                    <i class="fas fa-question-circle"></i> จัดการข้อสอบ
                </button>
                <button class="nav-btn" onclick="showSection('results')">
                    <i class="fas fa-chart-bar"></i> ดูผลสอบ
                </button>
                <button class="nav-btn" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> ตั้งค่าระบบ
                </button>
                <button class="nav-btn" onclick="location.href='index.html'">
                    <i class="fas fa-home"></i> หน้าหลัก
                </button>
                <button class="nav-btn logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
                </button>
            </div>
        </div>
    </header>
    
    <!-- Login Modal -->
    <div id="login-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2><i class="fas fa-lock"></i> เข้าสู่ระบบแอดมิน</h2>
            <div class="form-group">
                <label for="admin-username">ชื่อผู้ใช้</label>
                <input type="text" id="admin-username" placeholder="กรอกชื่อผู้ใช้">
            </div>
            <div class="form-group">
                <label for="admin-password">รหัสผ่าน</label>
                <input type="password" id="admin-password" placeholder="กรอกรหัสผ่าน">
            </div>
            <button class="form-btn primary" onclick="adminLogin()">
                <i class="fas fa-sign-in-alt"></i> เข้าสู่ระบบ
            </button>
            <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                <i class="fas fa-info-circle"></i> กรุณาติดต่อครูผู้สอนเพื่อขอรหัสผ่าน
            </p>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="admin-container" id="admin-container" style="display: none;">
        <!-- Sidebar -->
        <div class="admin-sidebar">
            <div class="admin-info">
                <h3><i class="fas fa-user-circle"></i> ผู้ดูแลระบบ</h3>
                <p id="admin-name">ครูรัชพล</p>
                <p style="font-size: 0.8rem; color: #666;">โรงเรียนพรตพิทยพยัต</p>
            </div>
            
            <h3 class="sidebar-title"><i class="fas fa-question-circle"></i> ประเภทข้อสอบ</h3>
            <div class="question-type-list">
                <!-- ... ประเภทข้อสอบ ... -->
            </div>
            
            <div class="sidebar-actions">
                <button class="form-btn success" onclick="saveToLocalStorage()">
                    <i class="fas fa-save"></i> บันทึกข้อสอบ
                </button>
                <button class="form-btn secondary" onclick="loadFromLocalStorage()">
                    <i class="fas fa-sync"></i> โหลดข้อสอบ
                </button>
                <button class="form-btn" onclick="exportQuestions()" style="background: #f39c12;">
                    <i class="fas fa-download"></i> ส่งออก
                </button>
                <button class="form-btn" onclick="importQuestions()" style="background: #9b59b6;">
                    <i class="fas fa-upload"></i> นำเข้า
                </button>
            </div>
            
            <div class="system-info">
                <h4><i class="fas fa-info-circle"></i> ข้อมูลระบบ</h4>
                <p>ข้อสอบทั้งหมด: <span id="total-questions-info">0</span> ข้อ</p>
                <p>นักเรียนที่ทำสอบ: <span id="total-students">0</span> คน</p>
                <p>อัปเดตล่าสุด: <span id="last-updated">-</span></p>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="admin-main">
            <!-- ... ส่วนจัดการข้อสอบ ... -->
            <!-- (โค้ดเหมือนเดิม) -->
        </div>
    </div>

    <script>
        // =================== ตั้งค่าสำหรับ GitHub Pages ===================
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'prot2025'; // เปลี่ยนรหัสผ่านตามต้องการ
        const BASE_URL = window.location.origin + window.location.pathname.replace(/\/[^\/]*$/, '/');
        
        // =================== เริ่มต้นระบบ ===================
        document.addEventListener('DOMContentLoaded', function() {
            // ตรวจสอบการล็อกอิน
            const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            
            if (isLoggedIn) {
                showAdminPanel();
            } else {
                showLoginModal();
            }
            
            // ตั้งค่าปุ่มประเภทข้อสอบ
            setupQuestionTypes();
            
            // โหลดข้อสอบ
            loadFromLocalStorage();
            
            // ตั้งค่าระบบ
            initializeSystem();
        });
        
        // =================== การล็อกอิน ===================
        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'flex';
            document.getElementById('admin-container').style.display = 'none';
        }
        
        function showAdminPanel() {
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('admin-container').style.display = 'grid';
            
            // แสดงชื่อผู้ดูแลระบบ
            const adminName = localStorage.getItem('adminName') || 'ครูผู้สอน';
            document.getElementById('admin-name').textContent = adminName;
            
            // อัปเดตข้อมูลระบบ
            updateSystemInfo();
        }
        
        function adminLogin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                // ล็อกอินสำเร็จ
                localStorage.setItem('adminLoggedIn', 'true');
                localStorage.setItem('adminName', 'ครูรัชพล');
                localStorage.setItem('loginTime', new Date().toISOString());
                
                showAdminPanel();
                showAlert('success', 'เข้าสู่ระบบสำเร็จ');
            } else {
                showAlert('error', 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');
            }
        }
        
        function logout() {
            if (confirm('ต้องการออกจากระบบใช่หรือไม่?')) {
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminName');
                showLoginModal();
                showAlert('success', 'ออกจากระบบสำเร็จ');
            }
        }
        
        // =================== ตั้งค่าระบบ ===================
        function initializeSystem() {
            // ตรวจสอบวันที่
            const today = new Date().toLocaleDateString('th-TH');
            document.getElementById('last-updated').textContent = today;
            
            // ตั้งค่า event listeners
            setupEventListeners();
        }
        
        function updateSystemInfo() {
            // อัปเดตจำนวนข้อสอบ
            const questions = JSON.parse(localStorage.getItem('examQuestions') || '[]');
            document.getElementById('total-questions-info').textContent = questions.length;
            
            // อัปเดตจำนวนนักเรียน (จากผลสอบ)
            const results = JSON.parse(localStorage.getItem('examHistory') || '[]');
            document.getElementById('total-students').textContent = results.length;
        }
        
        // =================== ฟังก์ชันจัดการไฟล์ ===================
        function importQuestions() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const questions = JSON.parse(e.target.result);
                        localStorage.setItem('examQuestions', JSON.stringify(questions));
                        loadFromLocalStorage();
                        showAlert('success', 'นำเข้าข้อสอบสำเร็จ');
                    } catch (error) {
                        showAlert('error', 'ไฟล์ไม่ถูกต้อง');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // =================== สร้างข้อสอบตัวอย่างอัตโนมัติ ===================
        function generateSampleQuestions() {
            const sampleQuestions = [
                // ... ข้อสอบตัวอย่าง ...
            ];
            
            localStorage.setItem('examQuestions', JSON.stringify(sampleQuestions));
            loadFromLocalStorage();
            showAlert('success', 'สร้างข้อสอบตัวอย่างสำเร็จ');
        }
        
        // =================== ส่งออกผลสอบ ===================
        function exportResults() {
            const results = JSON.parse(localStorage.getItem('examHistory') || '[]');
            const dataStr = JSON.stringify(results, null, 2);
            downloadFile(dataStr, 'exam-results.json', 'application/json');
        }
        
        function downloadFile(content, fileName, contentType) {
            const a = document.createElement('a');
            const file = new Blob([content], {type: contentType});
            a.href = URL.createObjectURL(file);
            a.download = fileName;
            a.click();
        }
        
        // =================== แสดงส่วนต่างๆ ===================
        function showSection(section) {
            // ... โค้ดเดิม ...
        }
        
        // =================== ฟังก์ชันเสริม ===================
        function showAlert(type, message) {
            // ... โค้ดเดิม ...
        }
        
        // ฟังก์ชันอื่นๆ ทั้งหมดเหมือนเดิม
        // ... (โค้ดจาก admin.html เดิมทั้งหมด) ...
    </script>
</body>
</html>
