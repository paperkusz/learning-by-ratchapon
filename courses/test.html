<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบทดสอบ Arduino | โรงเรียนตัวอย่าง</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kanit', 'Sarabun', sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--primary-color);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 0;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
            color: white;
        }
        
        .logo img {
            height: 50px;
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 500;
        }
        
        /* Navigation */
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }
        
        .nav-menu a:hover {
            background-color: rgba(255,255,255,0.2);
        }
        
        /* Exam Page */
        .exam-page {
            min-height: calc(100vh - 120px);
            padding: 2rem 0;
        }
        
        .exam-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* Registration Section */
        .registration-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 3rem 2rem;
            text-align: center;
            display: block;
        }
        
        .registration-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }
        
        .registration-subtitle {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        .registration-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--primary-color);
        }
        
        .form-group input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .form-info {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .start-exam-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.8rem 2.5rem;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-top: 1rem;
        }
        
        .start-exam-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .start-exam-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Exam Content */
        .exam-content {
            display: none;
        }
        
        .exam-header {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .exam-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .student-info {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .student-info-item {
            font-weight: 500;
        }
        
        /* Exam Sections */
        .exam-sections {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .section-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .section-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 50%;
            font-weight: 500;
        }
        
        .section-name {
            font-size: 1.3rem;
            font-weight: 500;
            color: var(--primary-color);
        }
        
        .section-details {
            font-size: 0.9rem;
            color: #666;
        }
        
        .section-toggle {
            font-size: 1.2rem;
            color: var(--primary-color);
            transition: var(--transition);
        }
        
        .section-toggle.open {
            transform: rotate(180deg);
        }
        
        .section-content {
            display: none;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-top: -1rem;
        }
        
        .section-content.active {
            display: block;
        }
        
        /* Quiz Containers */
        .matching-quiz-container, .mcq-quiz-container {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .quiz-instruction {
            background-color: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            border-left: 4px solid var(--secondary-color);
        }
        
        .instruction-title {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .question-item {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        
        .question-item:last-child {
            border-bottom: none;
        }
        
        .question-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .question-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-weight: 500;
            flex-shrink: 0;
        }
        
        .question-text {
            font-weight: 500;
            flex-grow: 1;
        }
        
        .matching-answer, .mcq-options {
            margin-left: 3rem;
        }
        
        .answer-select {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: white;
            font-size: 1rem;
            width: 100%;
            max-width: 300px;
            cursor: pointer;
        }
        
        .answer-select:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        .mcq-option {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 0.8rem;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: white;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .mcq-option:hover {
            border-color: var(--secondary-color);
            background-color: rgba(52, 152, 219, 0.05);
        }
        
        .mcq-option.selected {
            background-color: rgba(52, 152, 219, 0.1);
            border-color: var(--secondary-color);
        }
        
        .mcq-option input {
            display: none;
        }
        
        .option-letter {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background-color: #eee;
            color: var(--primary-color);
            border-radius: 50%;
            font-weight: 500;
            flex-shrink: 0;
        }
        
        .mcq-option.selected .option-letter {
            background-color: var(--secondary-color);
            color: white;
        }
        
        /* Options Container */
        .options-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .options-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .option-item {
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }
        
        .option-letter-small {
            display: inline-block;
            width: 24px;
            height: 24px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 0.5rem;
            font-weight: 500;
        }
        
        /* Progress Bar */
        .progress-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            border-top: 1px solid #eee;
            display: none;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--secondary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--primary-color);
        }
        
        /* Submit Button */
        .submit-container {
            text-align: center;
            margin: 2rem 0;
        }
        
        .submit-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.8rem 2.5rem;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .submit-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        
        /* Result Section */
        .result-container {
            display: none;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }
        
        .result-title {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .score {
            font-size: 3rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
        }
        
        .result-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .result-card {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 1.5rem;
        }
        
        .result-card h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .result-card p {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .back-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 2.5rem;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .back-btn:hover {
            background-color: #1a252f;
            transform: translateY(-2px);
        }
        
        /* Warning Message */
        .warning-message {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 2rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Footer */
        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 3rem 0 1rem;
            margin-top: 2rem;
        }
        
        .footer-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 0 1rem;
        }
        
        .footer-col h3 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .footer-col h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background-color: var(--accent-color);
        }
        
        .footer-col a {
            display: block;
            color: #ddd;
            margin-bottom: 0.8rem;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-col a:hover {
            color: var(--accent-color);
            padding-left: 5px;
        }
        
        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 50%;
            color: white;
            transition: var(--transition);
        }
        
        .social-links a:hover {
            background-color: var(--accent-color);
            transform: translateY(-3px);
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem 0;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .matching-answer, .mcq-options {
                margin-left: 0;
            }
            
            .result-details {
                grid-template-columns: 1fr;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .student-info {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="header-container">
            <a href="/learning-by-ratchapon/index.html" class="logo">
                <img src="https://avatars.githubusercontent.com/u/67259782?s=400&u=9a07ea2e64a9d37ca64a03e1bdd3bf27726dda33&v=4" alt="สื่อการสอน By Ratchapon">
                <span class="logo-text">สื่อการสอนออนไลน์</span>
            </a>
            
            <ul class="nav-menu">
                <li><a href="/learning-by-ratchapon/index.html">หน้าหลัก</a></li>
                <li><a href="/learning-by-ratchapon/about.html">ประวัติครู</a></li>
                <li><a href="/learning-by-ratchapon/achievements.html">ผลงาน</a></li>
                <li><a href="/learning-by-ratchapon/courses.html">วิชาทั้งหมด</a></li>
                <li><a href="/learning-by-ratchapon/knowledge.html">คลังความรู้</a></li>
                <li><a href="/learning-by-ratchapon/contact.html">ติดต่อเรา</a></li>
            </ul>
        </div>
    </header>
    
    <!-- Exam Page -->
    <section class="exam-page">
        <div class="exam-container">
            <!-- Registration Section -->
            <div class="registration-container" id="registration-container">
                <h1 class="registration-title">แบบทดสอบ Arduino</h1>
                <p class="registration-subtitle">กรุณากรอกข้อมูลส่วนตัวก่อนเริ่มทำแบบทดสอบ</p>
                
                <div class="form-info">
                    <p><i class="fas fa-info-circle"></i> <strong>หมายเหตุ:</strong> แต่ละ IP Address สามารถทำแบบทดสอบได้เพียงครั้งเดียว</p>
                </div>
                
                <form class="registration-form" id="registration-form">
                    <div class="form-group">
                        <label for="firstName">ชื่อ</label>
                        <input type="text" id="firstName" name="firstName" required placeholder="กรุณากรอกชื่อ">
                    </div>
                    
                    <div class="form-group">
                        <label for="lastName">นามสกุล</label>
                        <input type="text" id="lastName" name="lastName" required placeholder="กรุณากรอกนามสกุล">
                    </div>
                    
                    <div class="form-group">
                        <label for="studentId">เลขที่</label>
                        <input type="number" id="studentId" name="studentId" required placeholder="กรุณากรอกเลขที่" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="classRoom">ห้องเรียน</label>
                        <input type="text" id="classRoom" name="classRoom" required placeholder="ตัวอย่าง: ม.4/1">
                    </div>
                    
                    <div class="form-group">
                        <label for="studentCode">รหัสนักเรียน</label>
                        <input type="text" id="studentCode" name="studentCode" required placeholder="กรุณากรอกรหัสนักเรียน">
                    </div>
                    
                    <button type="submit" class="start-exam-btn" id="start-exam-btn">เริ่มทำแบบทดสอบ</button>
                </form>
                
                <div class="warning-message" id="already-submitted-warning" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>ไม่สามารถทำแบบทดสอบได้</strong>
                        <p>IP Address นี้ได้ทำแบบทดสอบไปแล้ว ระบบอนุญาตให้ทำได้เพียงครั้งเดียวต่อ IP Address</p>
                    </div>
                </div>
            </div>
            
            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loading-spinner">
                <div class="spinner"></div>
                <p>กำลังบันทึกผลการทดสอบ...</p>
            </div>
            
            <!-- Exam Content -->
            <div class="exam-content" id="exam-content">
                <div class="exam-header">
                    <h1 class="exam-title">แบบทดสอบ Arduino - 40 ข้อ</h1>
                    <div class="student-info" id="student-info-display">
                        <!-- ข้อมูลนักเรียนจะถูกเพิ่มโดย JavaScript -->
                    </div>
                    <p>รวมข้อสอบจับคู่ความสัมพันธ์ 14 ข้อ และข้อสอบเกี่ยวกับ Arduino UNO R3 และเซ็นเซอร์ 26 ข้อ</p>
                </div>
                
                <div class="exam-sections" id="exam-sections">
                    <!-- ส่วนที่ 1: จับคู่ความสัมพันธ์ (14 ข้อ) -->
                    <div class="section-header" onclick="toggleSection(1)">
                        <div class="section-title">
                            <div class="section-number">1</div>
                            <div>
                                <div class="section-name">จับคู่ความสัมพันธ์</div>
                                <div class="section-details">14 ข้อ (ตอนที่ 1)</div>
                            </div>
                        </div>
                        <div class="section-toggle" id="toggle-1"><i class="fas fa-chevron-down"></i></div>
                    </div>
                    <div class="section-content" id="section-1">
                        <div class="quiz-instruction">
                            <h3 class="instruction-title">ตอนที่ 1: จงจับคู่ความสัมพันธ์ถูกต้อง (สามารถตอบซ้ำข้อได้)</h3>
                            <p>ให้เลือกตัวเลือกที่ตรงกับความหมายของข้อทางซ้ายมือ สามารถเลือกตัวเลือกเดียวกันได้หลายข้อ</p>
                        </div>
                        
                        <div class="matching-quiz-container" id="matching-questions-1">
                            <!-- ข้อสอบจับคู่จะถูกเพิ่มโดย JavaScript -->
                        </div>
                        
                        <div class="options-container">
                            <h3 class="options-title">ตัวเลือกทั้งหมด (ตอนที่ 1)</h3>
                            <div class="options-grid" id="options-list-1">
                                <!-- ตัวเลือกจะถูกเพิ่มโดย JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ส่วนที่ 2: Arduino UNO R3 (14 ข้อ) -->
                    <div class="section-header" onclick="toggleSection(2)">
                        <div class="section-title">
                            <div class="section-number">2</div>
                            <div>
                                <div class="section-name">Arduino UNO R3</div>
                                <div class="section-details">14 ข้อ (ตอนที่ 2)</div>
                            </div>
                        </div>
                        <div class="section-toggle" id="toggle-2"><i class="fas fa-chevron-down"></i></div>
                    </div>
                    <div class="section-content" id="section-2">
                        <div class="quiz-instruction">
                            <h3 class="instruction-title">ตอนที่ 2: Arduino UNO R3 และพื้นฐาน</h3>
                            <p>เลือกคำตอบที่ถูกต้องที่สุดเพียงข้อเดียว</p>
                        </div>
                        
                        <div class="mcq-quiz-container" id="mcq-questions-2">
                            <!-- ข้อสอบ MCQ จะถูกเพิ่มโดย JavaScript -->
                        </div>
                    </div>
                    
                    <!-- ส่วนที่ 3: เซ็นเซอร์ต่างๆ (12 ข้อ) -->
                    <div class="section-header" onclick="toggleSection(3)">
                        <div class="section-title">
                            <div class="section-number">3</div>
                            <div>
                                <div class="section-name">เซ็นเซอร์และการประยุกต์ใช้งาน</div>
                                <div class="section-details">12 ข้อ (ตอนที่ 3)</div>
                            </div>
                        </div>
                        <div class="section-toggle" id="toggle-3"><i class="fas fa-chevron-down"></i></div>
                    </div>
                    <div class="section-content" id="section-3">
                        <div class="quiz-instruction">
                            <h3 class="instruction-title">ตอนที่ 3: เซ็นเซอร์และการประยุกต์ใช้งาน</h3>
                            <p>เลือกคำตอบที่ถูกต้องที่สุดเพียงข้อเดียว</p>
                        </div>
                        
                        <div class="mcq-quiz-container" id="mcq-questions-3">
                            <!-- ข้อสอบ MCQ จะถูกเพิ่มโดย JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="submit-container">
                    <button class="submit-btn" id="submit-btn">ส่งคำตอบทั้งหมด (40 ข้อ)</button>
                </div>
                
                <div class="result-container" id="result-container">
                    <h2 class="result-title">ผลการทำแบบทดสอบ</h2>
                    <div class="score" id="score">0/40</div>
                    
                    <div class="result-details">
                        <div class="result-card">
                            <h3>คำตอบที่ถูกต้อง</h3>
                            <p id="correct-answers">0</p>
                        </div>
                        <div class="result-card">
                            <h3>คำตอบที่ผิด</h3>
                            <p id="wrong-answers">0</p>
                        </div>
                        <div class="result-card">
                            <h3>ข้อที่ไม่ได้ตอบ</h3>
                            <p id="unanswered">0</p>
                        </div>
                        <div class="result-card">
                            <h3>คะแนนที่ได้</h3>
                            <p id="score-percentage">0%</p>
                        </div>
                    </div>
                    
                    <div class="result-details">
                        <div class="result-card">
                            <h3>ตอนที่ 1 (จับคู่)</h3>
                            <p id="section1-score">0/14</p>
                        </div>
                        <div class="result-card">
                            <h3>ตอนที่ 2 (UNO R3)</h3>
                            <p id="section2-score">0/14</p>
                        </div>
                        <div class="result-card">
                            <h3>ตอนที่ 3 (เซ็นเซอร์)</h3>
                            <p id="section3-score">0/12</p>
                        </div>
                        <div class="result-card">
                            <h3>ระดับผลการทดสอบ</h3>
                            <p id="grade">-</p>
                        </div>
                    </div>
                    
                    <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                        <i class="fas fa-check-circle" style="color: #2ecc71;"></i> ผลการทดสอบของคุณถูกบันทึกเรียบร้อยแล้ว
                    </p>
                    
                    <button class="back-btn" id="back-btn">กลับสู่หน้าหลัก</button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Progress Bar -->
    <div class="progress-container" id="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text">
            <span>ความคืบหน้า: <span id="progress-percentage">0%</span></span>
            <span>ตอบแล้ว: <span id="answered-count">0</span>/40 ข้อ</span>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-grid">
            <div class="footer-col">
                <h3>เกี่ยวกับเรา</h3>
                <p>สื่อการสอนออนไลน์ By Ratchapon</p>
                <p>ติดตามช่องทางอื่นๆ ได้ที่</p>
                <div class="social-links">
                    <a href="https://www.facebook.com/ipaperz/"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.youtube.com/@paperkusz-999"><i class="fab fa-youtube"></i></a>
                    <a href="https://line.me/ti/p/JgvbvajUfU"><i class="fab fa-line"></i></a>
                </div>
            </div>
            
            <div class="footer-col">
                <h3>ลิงก์ด่วน</h3>
                <a href="/learning-by-ratchapon/index.html">หน้าหลัก</a>
                <a href="/learning-by-ratchapon/about.html">ประวัติครู</a>
                <a href="/learning-by-ratchapon/achievements.html">ผลงาน</a>
                <a href="/learning-by-ratchapon/courses.html">วิชาทั้งหมด</a>
                <a href="/learning-by-ratchapon/knowledge.html">คลังความรู้</a>
            </div>
            
            <div class="footer-col">
                <h3>ระบบสมาชิก</h3>
                <a href="/learning-by-ratchapon/auth/login.html">เข้าสู่ระบบ</a>
                <a href="/learning-by-ratchapon/auth/register.html">สมัครสมาชิก</a>
                <a href="#">ลืมรหัสผ่าน</a>
                <a href="#">คำถามที่พบบ่อย</a>
            </div>
            
            <div class="footer-col">
                <h3>ติดต่อเรา</h3>
                <p><i class="fas fa-map-marker-alt"></i> โรงเรียนพรตพิทยพยัต 4 ถนนหลวงพรต แขวงลาดกระบัง เขตลาดกระบัง กรุงเทพมหานคร 10520</p>
                <p><i class="fas fa-phone"></i> 096-409-929-1</p>
                <p><i class="fas fa-envelope"></i> ratchapon@prot.ac.th</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; © 2025 สื่อการสอนออนไลน์ By Ratchapon (Ratchapon@prot.ac.th)</p>
        </div>
    </footer>

    <script>
        // =================== ข้อมูลข้อสอบ ===================
        const examData = {
            section1: {
                title: "จับคู่ความสัมพันธ์",
                type: "matching",
                questions: [
                    { id: 1, text: "boolean : ……….", answer: "O" },
                    { id: 2, text: "char : ………", answer: "L" },
                    { id: 3, text: "float : ………", answer: "D" },
                    { id: 4, text: "int : ………", answer: "C" },
                    { id: 5, text: "if : ………", answer: "F" },
                    { id: 6, text: "pinMode() : ………", answer: "A" },
                    { id: 7, text: "digitalRead() : ………", answer: "V" },
                    { id: 8, text: "digitalWrite() : ………", answer: "R" },
                    { id: 9, text: "analogRead() : ………", answer: "H" },
                    { id: 10, text: "delay() : ………", answer: "G" },
                    { id: 11, text: "/*… */ : ………", answer: "S" },
                    { id: 12, text: "// : ………", answer: "I" },
                    { id: 13, text: "; : ………", answer: "E" },
                    { id: 14, text: "[] : ………", answer: "J" }
                ],
                options: [
                    { letter: "A", text: "กําหนดหน้าที่ PIN" },
                    { letter: "B", text: "False" },
                    { letter: "C", text: "จํานวนเต็ม" },
                    { letter: "D", text: "ทศนิยม" },
                    { letter: "E", text: "จบคำสั่ง" },
                    { letter: "F", text: "กําหนดเงื่อนไข" },
                    { letter: "G", text: "ถ้า" },
                    { letter: "H", text: "อ่านค่าจากอนาล็อก PIN" },
                    { letter: "I", text: "คอมเมนต์ 1 บรรทัด" },
                    { letter: "J", text: "กําหนดขอบเขตโปรแกรม" },
                    { letter: "K", text: "TRUE" },
                    { letter: "L", text: "ตัวอักษร" },
                    { letter: "M", text: "5.8" },
                    { letter: "O", text: "ความถูกต้อง" },
                    { letter: "R", text: "สั่งดิจิตอล PIN ทำงาน" },
                    { letter: "S", text: "คอมเมนต์หลายบรรทัด" },
                    { letter: "T", text: "“Son" },
                    { letter: "V", text: "อ่านค่าจากดิจิตอล PIN" }
                ]
            },
            
            section2: {
                title: "Arduino UNO R3",
                type: "mcq",
                questions: [
                    {
                        id: 15,
                        text: "Arduino UNO R3 ใช้ไมโครคอนโทรลเลอร์ตระกูลอะไร?",
                        options: ["AVR", "PIC", "ARM", "8051"],
                        answer: 0
                    },
                    {
                        id: 16,
                        text: "ไมโครคอนโทรลเลอร์หลักบน Arduino UNO R3 คือรุ่นใด?",
                        options: ["ATmega328P", "ATmega2560", "ATmega32U4", "ATmega168"],
                        answer: 0
                    },
                    {
                        id: 17,
                        text: "Arduino UNO R3 มีพินดิจิตอลทั้งหมดกี่พิน?",
                        options: ["12 พิน", "14 พิน", "16 พิน", "20 พิน"],
                        answer: 1
                    },
                    {
                        id: 18,
                        text: "พินใดบน Arduino UNO R3 ที่สามารถใช้สำหรับ PWM ได้?",
                        options: ["พิน 3, 5, 6, 9, 10, 11", "พิน 2, 4, 7, 8, 12, 13", "ทุกพินดิจิตอล", "เฉพาะพินอนาล็อก"],
                        answer: 0
                    },
                    {
                        id: 19,
                        text: "Arduino UNO R3 มีพินอนาล็อกทั้งหมดกี่พิน?",
                        options: ["4 พิน", "6 พิน", "8 พิน", "10 พิน"],
                        answer: 1
                    },
                    {
                        id: 20,
                        text: "ความละเอียดของ Analog-to-Digital Converter (ADC) บน Arduino UNO R3 เป็นเท่าไร?",
                        options: ["8-bit", "10-bit", "12-bit", "16-bit"],
                        answer: 1
                    },
                    {
                        id: 21,
                        text: "ความถี่ในการทำงานของ Arduino UNO R3 เป็นเท่าไร?",
                        options: ["8 MHz", "16 MHz", "20 MHz", "24 MHz"],
                        answer: 1
                    },
                    {
                        id: 22,
                        text: "โวลเตจที่จ่ายให้กับ Arduino UNO R3 ผ่านพิน VIN ควรเป็นเท่าไร?",
                        options: ["3.3V", "5V", "7-12V", "12-24V"],
                        answer: 2
                    },
                    {
                        id: 23,
                        text: "พินใดบน Arduino UNO R3 ที่ใช้สำหรับการสื่อสารแบบ UART?",
                        options: ["พิน 0 (RX) และ 1 (TX)", "พิน 2 และ 3", "พิน 10 และ 11", "พิน 12 และ 13"],
                        answer: 0
                    },
                    {
                        id: 24,
                        text: "คำสั่งใดใช้สำหรับการหน่วงเวลาเป็นหน่วยมิลลิวินาที?",
                        options: ["delay()", "delayMicroseconds()", "millis()", "micros()"],
                        answer: 0
                    },
                    {
                        id: 25,
                        text: "พินใดบน Arduino UNO R3 ที่มี LED ติดมาด้วย?",
                        options: ["พิน 10", "พิน 11", "พิน 12", "พิน 13"],
                        answer: 3
                    },
                    {
                        id: 26,
                        text: "ข้อใดคือพินที่รองรับการขัดจังหวะ (Interrupt) บน Arduino UNO R3?",
                        options: ["พิน 2 และ 3", "พิน 4 และ 5", "พิน 6 และ 7", "พิน 8 และ 9"],
                        answer: 0
                    },
                    {
                        id: 27,
                        text: "หน่วยความจำแบบ Flash บน ATmega328P มีขนาดเท่าไร?",
                        options: ["16 KB", "32 KB", "64 KB", "128 KB"],
                        answer: 1
                    },
                    {
                        id: 28,
                        text: "ข้อใดคือโปรแกรมที่ใช้ในการอัพโหลดโค้ดไปยัง Arduino?",
                        options: ["Arduino IDE", "Bootloader", "AVRDUDE", "ถูกทุกข้อ"],
                        answer: 3
                    }
                ]
            },
            
            section3: {
                title: "เซ็นเซอร์และการประยุกต์ใช้งาน",
                type: "mcq",
                questions: [
                    {
                        id: 29,
                        text: "เซ็นเซอร์วัดอุณหภูมิและความชื้น DHT11 ให้ค่าออกมาในรูปแบบใด?",
                        options: ["อนาล็อก", "ดิจิตอล", "ทั้งอนาล็อกและดิจิตอล", "PWM"],
                        answer: 1
                    },
                    {
                        id: 30,
                        text: "เซ็นเซอร์ Ultrasonic HC-SR04 ใช้หลักการใดในการวัดระยะทาง?",
                        options: ["การสะท้อนของแสง", "การสะท้อนของเสียง", "การเปลี่ยนแปลงความต้านทาน", "การเหนี่ยวนำแม่เหล็กไฟฟ้า"],
                        answer: 1
                    },
                    {
                        id: 31,
                        text: "เซ็นเซอร์ PIR (Passive Infrared) มักใช้ในการตรวจจับอะไร?",
                        options: ["อุณหภูมิ", "ความเคลื่อนไหว", "ระยะทาง", "แสงสว่าง"],
                        answer: 1
                    },
                    {
                        id: 32,
                        text: "เซ็นเซอร์ LDR (Light Dependent Resistor) ทำงานอย่างไร?",
                        options: ["ความต้านทานเปลี่ยนแปลงตามอุณหภูมิ", "ความต้านทานเปลี่ยนแปลงตามแสง", "ให้แรงดันไฟฟ้าตามแสง", "ให้กระแสไฟฟ้าตามแสง"],
                        answer: 1
                    },
                    {
                        id: 33,
                        text: "เซ็นเซอร์ Flame Sensor ตรวจจับอะไร?",
                        options: ["ควัน", "เปลวไฟ", "แก๊ส", "ความร้อน"],
                        answer: 1
                    },
                    {
                        id: 34,
                        text: "เซ็นเซอร์ Gas MQ-2 มักใช้ตรวจจับอะไร?",
                        options: ["ออกซิเจน", "ไนโตรเจน", "แก๊สไวไฟและควัน", "คาร์บอนไดออกไซด์"],
                        answer: 2
                    },
                    {
                        id: 35,
                        text: "เซ็นเซอร์ Soil Moisture Sensor วัดอะไร?",
                        options: ["ค่าพีเอชของดิน", "ความชื้นในดิน", "ธาตุอาหารในดิน", "อุณหภูมิของดิน"],
                        answer: 1
                    },
                    {
                        id: 36,
                        text: "เซ็นเซอร์ Sound Sensor ตรวจจับอะไร?",
                        options: ["ความถี่เสียง", "ความดังเสียง", "ทั้งความถี่และความดังเสียง", "ชนิดของเสียง"],
                        answer: 1
                    },
                    {
                        id: 37,
                        text: "โมดูล Relay มักใช้สำหรับการควบคุมอะไร?",
                        options: ["ควบคุมความเร็วมอเตอร์", "ควบคุมอุปกรณ์ไฟฟ้าแรงดันสูง", "ควบคุมเซ็นเซอร์", "ควบคุมแสงสว่างโดยตรง"],
                        answer: 1
                    },
                    {
                        id: 38,
                        text: "เซ็นเซอร์ใดที่เหมาะสำหรับการทำโปรเจกต์วัดคุณภาพอากาศ?",
                        options: ["DHT11", "HC-SR04", "MQ-135", "LDR"],
                        answer: 2
                    },
                    {
                        id: 39,
                        text: "เซ็นเซอร์ใดใช้ในการทำระบบจอดรถอัตโนมัติ?",
                        options: ["PIR Sensor", "Ultrasonic Sensor", "Flame Sensor", "Sound Sensor"],
                        answer: 1
                    },
                    {
                        id: 40,
                        text: "การต่อเซ็นเซอร์หลายตัวกับ Arduino ควรระวังเรื่องใดมากที่สุด?",
                        options: ["สีของสายไฟ", "การใช้งานพินซ้ำซ้อน", "การจ่ายกระแสไฟพอเพียง", "ขนาดทางกายภาพของเซ็นเซอร์"],
                        answer: 2
                    }
                ]
            }
        };

        // =================== ตัวแปรระบบ ===================
        let userAnswers = {
            section1: new Array(examData.section1.questions.length).fill(''),
            section2: new Array(examData.section2.questions.length).fill(null),
            section3: new Array(examData.section3.questions.length).fill(null)
        };
        
        let studentInfo = {};
        let examStarted = false;
        let examSubmitted = false;
        
        // Google Apps Script URL - เปลี่ยนเป็น URL ของคุณ
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzC7qP_9d7c2GXx6e9JwWp6j5vV2h8H6q3l4r5t8u0n1i2o3p4q5r6s7t8u9v0/exec';
        
        // ตรวจสอบว่า IP นี้เคยสอบแล้วหรือไม่
        async function checkIPSubmission() {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=checkIP');
                const data = await response.json();
                return data.submitted;
            } catch (error) {
                console.error('Error checking IP submission:', error);
                return false;
            }
        }

        // =================== เริ่มต้นเมื่อโหลดหน้าเว็บ ===================
        document.addEventListener('DOMContentLoaded', async function() {
            // ตรวจสอบว่า IP นี้เคยสอบแล้วหรือไม่
            const alreadySubmitted = await checkIPSubmission();
            
            if (alreadySubmitted) {
                document.getElementById('already-submitted-warning').style.display = 'flex';
                document.getElementById('start-exam-btn').disabled = true;
                document.getElementById('start-exam-btn').textContent = 'ทำแบบทดสอบแล้ว';
            }
            
            // ตั้งค่าฟอร์มลงทะเบียน
            document.getElementById('registration-form').addEventListener('submit', startExam);
            
            // ตั้งค่าปุ่มส่งคำตอบ
            document.getElementById('submit-btn').addEventListener('click', submitAllSections);
            
            // ตั้งค่าปุ่มกลับหน้าหลัก
            document.getElementById('back-btn').addEventListener('click', () => {
                window.location.href = '/learning-by-ratchapon/index.html';
            });
        });
        
        // =================== เริ่มทำแบบทดสอบ ===================
        async function startExam(e) {
            e.preventDefault();
            
            // บันทึกข้อมูลนักเรียน
            studentInfo = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                studentId: document.getElementById('studentId').value.trim(),
                classRoom: document.getElementById('classRoom').value.trim(),
                studentCode: document.getElementById('studentCode').value.trim(),
                timestamp: new Date().toLocaleString('th-TH'),
                ipAddress: await getIPAddress()
            };
            
            // แสดงข้อมูลนักเรียน
            displayStudentInfo();
            
            // ซ่อนฟอร์มลงทะเบียนและแสดงข้อสอบ
            document.getElementById('registration-container').style.display = 'none';
            document.getElementById('exam-content').style.display = 'block';
            document.getElementById('progress-container').style.display = 'block';
            
            // แสดงข้อสอบทั้งหมด
            renderAllSections();
            
            examStarted = true;
        }
        
        // =================== แสดงข้อมูลนักเรียน ===================
        function displayStudentInfo() {
            const container = document.getElementById('student-info-display');
            container.innerHTML = `
                <div class="student-info-item">ชื่อ-สกุล: ${studentInfo.firstName} ${studentInfo.lastName}</div>
                <div class="student-info-item">เลขที่: ${studentInfo.studentId}</div>
                <div class="student-info-item">ห้อง: ${studentInfo.classRoom}</div>
                <div class="student-info-item">รหัส: ${studentInfo.studentCode}</div>
            `;
        }
        
        // =================== แสดงข้อสอบทุกส่วน ===================
        function renderAllSections() {
            renderSection1();
            renderSection2();
            renderSection3();
        }
        
        // =================== แสดงส่วนที่ 1 ===================
        function renderSection1() {
            const container = document.getElementById('matching-questions-1');
            const optionsContainer = document.getElementById('options-list-1');
            
            examData.section1.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.id = `section1-q${question.id}`;
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'question-header';
                
                const numberDiv = document.createElement('div');
                numberDiv.className = 'question-number';
                numberDiv.textContent = question.id;
                
                const textDiv = document.createElement('div');
                textDiv.className = 'question-text';
                textDiv.textContent = question.text;
                
                headerDiv.appendChild(numberDiv);
                headerDiv.appendChild(textDiv);
                
                const answerDiv = document.createElement('div');
                answerDiv.className = 'matching-answer';
                
                const select = document.createElement('select');
                select.className = 'answer-select';
                select.id = `answer-s1-${question.id}`;
                select.dataset.section = '1';
                select.dataset.questionIndex = index;
                
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '-- กรุณาเลือก --';
                defaultOption.disabled = true;
                defaultOption.selected = true;
                select.appendChild(defaultOption);
                
                examData.section1.options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.letter;
                    optionElement.textContent = `${option.letter}. ${option.text}`;
                    select.appendChild(optionElement);
                });
                
                select.addEventListener('change', function() {
                    const section = this.dataset.section;
                    const questionIndex = parseInt(this.dataset.questionIndex);
                    userAnswers[`section${section}`][questionIndex] = this.value;
                    
                    if (this.value === '') {
                        this.style.borderColor = '#ddd';
                    } else {
                        this.style.borderColor = '#3498db';
                    }
                    
                    updateProgress();
                });
                
                answerDiv.appendChild(select);
                questionDiv.appendChild(headerDiv);
                questionDiv.appendChild(answerDiv);
                container.appendChild(questionDiv);
            });
            
            examData.section1.options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-item';
                
                const letterSpan = document.createElement('span');
                letterSpan.className = 'option-letter-small';
                letterSpan.textContent = option.letter;
                
                const textSpan = document.createElement('span');
                textSpan.textContent = option.text;
                
                optionDiv.appendChild(letterSpan);
                optionDiv.appendChild(textSpan);
                optionsContainer.appendChild(optionDiv);
            });
        }
        
        // =================== แสดงส่วนที่ 2 ===================
        function renderSection2() {
            const container = document.getElementById('mcq-questions-2');
            
            examData.section2.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.id = `section2-q${question.id}`;
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'question-header';
                
                const numberDiv = document.createElement('div');
                numberDiv.className = 'question-number';
                numberDiv.textContent = question.id;
                
                const textDiv = document.createElement('div');
                textDiv.className = 'question-text';
                textDiv.textContent = question.text;
                
                headerDiv.appendChild(numberDiv);
                headerDiv.appendChild(textDiv);
                
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'mcq-options';
                
                question.options.forEach((option, optionIndex) => {
                    const optionDiv = document.createElement('label');
                    optionDiv.className = 'mcq-option';
                    
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `question-s2-${question.id}`;
                    input.value = optionIndex;
                    input.dataset.section = '2';
                    input.dataset.questionIndex = index;
                    
                    const letterDiv = document.createElement('div');
                    letterDiv.className = 'option-letter';
                    letterDiv.textContent = String.fromCharCode(65 + optionIndex);
                    
                    const textSpan = document.createElement('span');
                    textSpan.textContent = option;
                    
                    optionDiv.appendChild(input);
                    optionDiv.appendChild(letterDiv);
                    optionDiv.appendChild(textSpan);
                    
                    optionDiv.addEventListener('click', function() {
                        optionsDiv.querySelectorAll('.mcq-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        this.classList.add('selected');
                        
                        const section = input.dataset.section;
                        const questionIndex = parseInt(input.dataset.questionIndex);
                        userAnswers[`section${section}`][questionIndex] = optionIndex;
                        
                        updateProgress();
                    });
                    
                    optionsDiv.appendChild(optionDiv);
                });
                
                questionDiv.appendChild(headerDiv);
                questionDiv.appendChild(optionsDiv);
                container.appendChild(questionDiv);
            });
        }
        
        // =================== แสดงส่วนที่ 3 ===================
        function renderSection3() {
            const container = document.getElementById('mcq-questions-3');
            
            examData.section3.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.id = `section3-q${question.id}`;
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'question-header';
                
                const numberDiv = document.createElement('div');
                numberDiv.className = 'question-number';
                numberDiv.textContent = question.id;
                
                const textDiv = document.createElement('div');
                textDiv.className = 'question-text';
                textDiv.textContent = question.text;
                
                headerDiv.appendChild(numberDiv);
                headerDiv.appendChild(textDiv);
                
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'mcq-options';
                
                question.options.forEach((option, optionIndex) => {
                    const optionDiv = document.createElement('label');
                    optionDiv.className = 'mcq-option';
                    
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `question-s3-${question.id}`;
                    input.value = optionIndex;
                    input.dataset.section = '3';
                    input.dataset.questionIndex = index;
                    
                    const letterDiv = document.createElement('div');
                    letterDiv.className = 'option-letter';
                    letterDiv.textContent = String.fromCharCode(65 + optionIndex);
                    
                    const textSpan = document.createElement('span');
                    textSpan.textContent = option;
                    
                    optionDiv.appendChild(input);
                    optionDiv.appendChild(letterDiv);
                    optionDiv.appendChild(textSpan);
                    
                    optionDiv.addEventListener('click', function() {
                        optionsDiv.querySelectorAll('.mcq-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        this.classList.add('selected');
                        
                        const section = input.dataset.section;
                        const questionIndex = parseInt(input.dataset.questionIndex);
                        userAnswers[`section${section}`][questionIndex] = optionIndex;
                        
                        updateProgress();
                    });
                    
                    optionsDiv.appendChild(optionDiv);
                });
                
                questionDiv.appendChild(headerDiv);
                questionDiv.appendChild(optionsDiv);
                container.appendChild(questionDiv);
            });
        }
        
        // =================== เปิด/ปิดส่วน ===================
        function toggleSection(sectionNumber) {
            const content = document.getElementById(`section-${sectionNumber}`);
            const toggle = document.getElementById(`toggle-${sectionNumber}`);
            
            content.classList.toggle('active');
            toggle.classList.toggle('open');
        }
        
        // =================== อัปเดตความคืบหน้า ===================
        function updateProgress() {
            if (!examStarted) return;
            
            let totalAnswered = 0;
            const totalQuestions = 40;
            
            totalAnswered += userAnswers.section1.filter(answer => answer !== '').length;
            totalAnswered += userAnswers.section2.filter(answer => answer !== null).length;
            totalAnswered += userAnswers.section3.filter(answer => answer !== null).length;
            
            const percentage = Math.round((totalAnswered / totalQuestions) * 100);
            
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('progress-percentage').textContent = `${percentage}%`;
            document.getElementById('answered-count').textContent = totalAnswered;
        }
        
        // =================== ส่งคำตอบทั้งหมด ===================
        async function submitAllSections() {
            if (examSubmitted) {
                alert('คุณได้ส่งคำตอบไปแล้ว');
                return;
            }
            
            // ตรวจสอบว่าตอบครบทุกข้อหรือไม่
            const totalAnswered = 
                userAnswers.section1.filter(a => a !== '').length +
                userAnswers.section2.filter(a => a !== null).length +
                userAnswers.section3.filter(a => a !== null).length;
            
            if (totalAnswered < 40) {
                const confirmSubmit = confirm(`คุณตอบคำถามเพียง ${totalAnswered}/40 ข้อ\nต้องการส่งคำตอบใช่หรือไม่?`);
                if (!confirmSubmit) return;
            }
            
            // แสดง loading spinner
            document.getElementById('loading-spinner').style.display = 'flex';
            document.getElementById('submit-btn').disabled = true;
            
            // คำนวณคะแนน
            const results = calculateResults();
            
            // บันทึกลง Google Sheets
            const saveSuccess = await saveToGoogleSheets(results);
            
            // ซ่อน loading spinner
            document.getElementById('loading-spinner').style.display = 'none';
            
            if (saveSuccess) {
                // แสดงผลลัพธ์
                showResults(results);
                examSubmitted = true;
            } else {
                alert('เกิดข้อผิดพลาดในการบันทึกผล กรุณาลองใหม่อีกครั้ง');
                document.getElementById('submit-btn').disabled = false;
            }
        }
        
        // =================== คำนวณคะแนน ===================
        function calculateResults() {
            let totalCorrect = 0;
            let section1Correct = 0;
            let section2Correct = 0;
            let section3Correct = 0;
            
            // ตรวจสอบส่วนที่ 1
            examData.section1.questions.forEach((question, index) => {
                const userAnswer = userAnswers.section1[index];
                if (userAnswer === question.answer) {
                    section1Correct++;
                    totalCorrect++;
                }
            });
            
            // ตรวจสอบส่วนที่ 2
            examData.section2.questions.forEach((question, index) => {
                const userAnswer = userAnswers.section2[index];
                if (userAnswer === question.answer) {
                    section2Correct++;
                    totalCorrect++;
                }
            });
            
            // ตรวจสอบส่วนที่ 3
            examData.section3.questions.forEach((question, index) => {
                const userAnswer = userAnswers.section3[index];
                if (userAnswer === question.answer) {
                    section3Correct++;
                    totalCorrect++;
                }
            });
            
            return {
                totalCorrect,
                section1Correct,
                section2Correct,
                section3Correct,
                totalQuestions: 40
            };
        }
        
        // =================== บันทึกลง Google Sheets ===================
        async function saveToGoogleSheets(results) {
            try {
                const submissionData = {
                    action: 'submit',
                    studentInfo: studentInfo,
                    answers: {
                        section1: userAnswers.section1,
                        section2: userAnswers.section2,
                        section3: userAnswers.section3
                    },
                    results: results,
                    timestamp: new Date().toISOString()
                };
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // ใช้ no-cors สำหรับ GitHub Pages
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submissionData)
                });
                
                return true;
            } catch (error) {
                console.error('Error saving to Google Sheets:', error);
                return false;
            }
        }
        
        // =================== แสดงผลลัพธ์ ===================
        function showResults(results) {
            const totalQuestions = results.totalQuestions;
            const totalCorrect = results.totalCorrect;
            const unanswered = totalQuestions - (
                userAnswers.section1.filter(a => a !== '').length +
                userAnswers.section2.filter(a => a !== null).length +
                userAnswers.section3.filter(a => a !== null).length
            );
            
            const wrong = totalQuestions - totalCorrect - unanswered;
            const percentage = Math.round((totalCorrect / totalQuestions) * 100);
            
            // อัปเดตผลลัพธ์
            document.getElementById('score').textContent = `${totalCorrect}/${totalQuestions}`;
            document.getElementById('correct-answers').textContent = totalCorrect;
            document.getElementById('wrong-answers').textContent = wrong;
            document.getElementById('unanswered').textContent = unanswered;
            document.getElementById('score-percentage').textContent = `${percentage}%`;
            
            document.getElementById('section1-score').textContent = `${results.section1Correct}/14`;
            document.getElementById('section2-score').textContent = `${results.section2Correct}/14`;
            document.getElementById('section3-score').textContent = `${results.section3Correct}/12`;
            
            // กำหนดเกรด
            let grade = '';
            if (percentage >= 80) grade = 'ดีเยี่ยม';
            else if (percentage >= 70) grade = 'ดี';
            else if (percentage >= 60) grade = 'พอใช้';
            else grade = 'ต้องปรับปรุง';
            
            document.getElementById('grade').textContent = grade;
            
            // แสดงส่วนผลลัพธ์
            document.getElementById('result-container').style.display = 'block';
            document.getElementById('progress-container').style.display = 'none';
            
            // เลื่อนไปยังผลลัพธ์
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }
        
        // =================== ฟังก์ชันเสริม ===================
        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Error getting IP address:', error);
                return 'unknown';
            }
        }
    </script>
</body>
</html>
