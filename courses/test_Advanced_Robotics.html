<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>แบบทดสอบ | หุ่นยนต์เบื้องต้น (สุ่ม 40/100)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #0066cc;
  --secondary: #3399ff;
  --accent: #ff6600;
  --bg: #f3f8ff;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
  --ok: #22c55e;
  --warn: #f59e0b;
  --bad: #ef4444;
  --radius: 12px;
  --shadow: 0 10px 30px rgba(0,0,0,0.10);
  --transition: all 0.2s ease;
}
* { box-sizing: border-box; font-family: 'Kanit','Sarabun',sans-serif; user-select:none; }
body {
  margin:0; background: linear-gradient(135deg, #e6f2ff 0%, #f8fbff 100%);
  color: var(--text); min-height:100vh; padding-bottom:90px;
}
.header {
  position: sticky; top:0; z-index:1000;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color:#fff; padding: 14px 18px; border-bottom: 4px solid var(--accent);
  box-shadow: 0 6px 16px rgba(0,102,204,0.25);
}
.header-row { max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:12px; }
.brand { display:flex; align-items:center; gap:10px; font-weight:600; }
.brand i { color:#fff; }
.pill {
  background: rgba(255,255,255,0.15);
  border:1px solid rgba(255,255,255,0.25);
  padding:8px 12px; border-radius:999px;
  display:flex; align-items:center; gap:8px;
}
.timer.pulse-warn { background: rgba(245, 158, 11, 0.25); border-color: rgba(245,158,11,0.55); }
.timer.pulse-bad  { background: rgba(239, 68, 68, 0.25); border-color: rgba(239,68,68,0.55); }
.container { max-width:1100px; margin: 18px auto; padding: 0 14px; }
.card {
  background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow);
  border: 1px solid rgba(0,0,0,0.06);
}
.card-pad { padding: 18px; }
h1,h2 { margin:0; }
.sub { color: var(--muted); font-size: 0.95rem; margin-top:6px; }
.grid { display:grid; gap:12px; }
.grid-2 { grid-template-columns: 1fr 1fr; }
@media (max-width: 900px) { .grid-2 { grid-template-columns:1fr; } }
.field label { font-size:0.9rem; color:#1f3a60; font-weight:500; display:block; margin-bottom:6px; }
.field input {
  width:100%; padding: 12px 12px; border-radius: 10px;
  border:1px solid #d9e3f2; outline:none; font-size: 1rem;
}
.field input:focus { border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(51,153,255,0.18); }
.btn {
  border:0; cursor:pointer; padding: 12px 18px; border-radius: 999px;
  font-weight:600; transition: var(--transition); display:inline-flex; align-items:center; gap:8px;
}
.btn-primary {
  background: linear-gradient(90deg, var(--secondary), var(--primary));
  color:#fff; box-shadow: 0 10px 18px rgba(0,102,204,0.22);
}
.btn-primary:hover { transform: translateY(-2px); }
.btn-accent {
  background: linear-gradient(90deg, var(--accent), #ff9b3a);
  color:#fff; box-shadow: 0 10px 18px rgba(255,102,0,0.22);
}
.btn-accent:hover { transform: translateY(-2px); }
.note {
  background: #eef6ff; border:1px solid #cfe4ff; border-left: 5px solid var(--accent);
  padding: 12px 12px; border-radius: 12px; color:#204b7a;
}
.warn {
  background: #fff7ed; border:1px solid #ffd6a5; border-left: 5px solid var(--warn);
  padding: 12px 12px; border-radius: 12px; color:#7a4a0f;
}
.bad {
  background: #fff1f2; border:1px solid #fecdd3; border-left: 5px solid var(--bad);
  padding: 12px 12px; border-radius: 12px; color:#7f1d1d;
}
.qcard {
  margin-top: 12px; padding: 14px; border-radius: 14px;
  border:1px solid #e5e7eb;
}
.qtitle {
  font-weight:600; color: var(--primary); display:flex; align-items:center; gap:8px; margin-bottom: 10px;
}
.options { display:grid; gap:10px; }
.option {
  border:2px solid #e5e7eb; border-radius: 12px; padding: 10px 12px;
  cursor:pointer; transition: var(--transition); position:relative; background:#fff;
}
.option:hover { border-color: var(--secondary); background:#f3f9ff; transform: translateX(4px); }
.option.selected { border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(51,153,255,0.18); background: rgba(51,153,255,0.08); }
.option.selected::after {
  content: "\f00c"; font-family: "Font Awesome 6 Free"; font-weight: 900;
  position:absolute; right: 12px; top: 10px; color: var(--ok);
}
.progress {
  position: fixed; left:0; right:0; bottom:0; z-index:100;
  background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
  border-top: 3px solid var(--primary);
  box-shadow: 0 -10px 25px rgba(0,0,0,0.08);
  padding: 12px 12px;
}
.pb-title { text-align:center; font-weight:600; color: var(--primary); margin-bottom: 8px; }
.pb { display:flex; flex-wrap:wrap; gap:6px; justify-content:center; }
.pb button {
  width: 38px; height: 38px; border-radius:999px; border:2px solid #e5e7eb;
  background:#fff; cursor:pointer; font-weight:600;
}
.pb button.answered { background: linear-gradient(135deg, var(--secondary), var(--primary)); color:#fff; border-color: var(--secondary); }
.pb button.current { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(255,102,0,0.18); transform: scale(1.05); }
.toast {
  position: fixed; right: 16px; top: 16px; z-index: 9999;
  padding: 12px 14px; border-radius: 12px; color:#fff; font-weight:600;
  display:none; box-shadow: var(--shadow);
}
.toast.info { background: linear-gradient(90deg, var(--secondary), var(--primary)); }
.toast.warn { background: linear-gradient(90deg, var(--warn), #fbbf24); }
.toast.bad  { background: linear-gradient(90deg, var(--bad), #fb7185); }
.toast.ok   { background: linear-gradient(90deg, var(--ok), #86efac); }
/* Lock overlay */
.lock {
  position: fixed; inset:0; z-index: 10000; display:none;
  background: rgba(0,0,0,0.68);
  align-items:center; justify-content:center; padding: 16px;
}
.lock .box {
  width:min(720px, 96vw); background:#fff; border-radius: 18px; padding: 18px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.12);
}
.lock h3 { margin:0 0 8px 0; color: #b91c1c; }
.lock p { margin: 6px 0; color: #374151; }
.lock .mini { color:#6b7280; font-size:0.95rem; }

        /* ===== Code example box (for system-style questions) ===== */
        .code-box{
            margin: .8rem 0 1rem;
            border-radius: 12px;
            border: 1px solid var(--medium-gray);
            background: #0b1020;
            color: #e6edf3;
            padding: 14px 16px;
            overflow-x: auto;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.92rem;
            line-height: 1.45;
        }
        .code-box code{ white-space: pre; }
        .code-caption{
            display:inline-flex;
            align-items:center;
            gap:.5rem;
            font-weight:600;
            color: var(--dark-blue);
            margin-top:.4rem;
            margin-bottom:.4rem;
        }
        .code-caption i{ color: var(--accent-orange); }

    </style>
</head>
<body>
<header class="header">
  <div class="header-row">
    <div class="brand"><i class="fa-solid fa-robot"></i> แบบทดสอบวิชาหุ่นยนต์เบื้องต้น (สุ่ม 40/100)</div>
    <div class="pill timer" id="timer"><i class="fa-regular fa-clock"></i> <span id="timerText">00:40:00</span></div>
  </div>
</header>

<div class="container">
  <div class="card card-pad" id="screenStart">
    <h2><i class="fa-solid fa-file-pen"></i> เริ่มทำแบบทดสอบ</h2>
    <div class="sub">ระบบจะสุ่มข้อสอบ <b>40 ข้อ</b> จากคลัง <b>100 ข้อ</b> (ปรนัย 4 ตัวเลือก) เวลา <b>40 นาที</b></div>

    <div class="note" style="margin-top:12px">
      <b>ข้อควรทราบ (โหมดคุมสอบ)</b><br>
      • ระบบจะพยายามเข้าสู่โหมดเต็มหน้าจออัตโนมัติ (คล้ายกด F11)<br>
      • ระหว่างทำข้อสอบ: หากสลับแท็บ/ออกจากหน้า/ออกจากเต็มหน้าจอ ระบบจะ <b>พักการสอบ</b> (หยุดจับเวลา) และให้กลับเข้าสู่โหมดเต็มหน้าจอก่อนจึงทำต่อได้<br>
      • ทำได้ 1 ครั้งต่อเครื่อง (บันทึกด้วย LocalStorage)
    </div>

    <div class="grid grid-2" style="margin-top:14px">
      <div class="field">
        <label><i class="fa-solid fa-signature"></i> ชื่อ</label>
        <input id="firstName" placeholder="เช่น รัชพล" />
      </div>
      <div class="field">
        <label><i class="fa-solid fa-signature"></i> นามสกุล</label>
        <input id="lastName" placeholder="เช่น ไชยวงค์" />
      </div>
      <div class="field">
        <label><i class="fa-solid fa-hashtag"></i> เลขที่</label>
        <input id="number" placeholder="เช่น 15" />
      </div>
      <div class="field">
        <label><i class="fa-solid fa-door-open"></i> ห้อง</label>
        <input id="room" placeholder="เช่น ม.4/1" />
      </div>
    </div>

    <div class="warn" style="margin-top:12px">
      <i class="fa-solid fa-shield-halved"></i>
      <b>หมายเหตุ:</b> เบราว์เซอร์ไม่สามารถ “บล็อก Print Screen/Alt+Tab” ได้ 100% ในทุกระบบปฏิบัติการ
      แต่ระบบจะตรวจจับการสลับแท็บ/เสียโฟกัส/ออกเต็มหน้าจอ และ <b>ส่งข้อสอบอัตโนมัติ</b>
    </div>

    <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap">
      <button class="btn btn-primary" id="btnStart"><i class="fa-solid fa-play"></i> เริ่มทำแบบทดสอบ (เข้าสู่เต็มหน้าจอ)</button>
    </div>
  </div>

  <div class="card card-pad" id="screenAlready" style="display:none">
    <h2 style="color: var(--bad)"><i class="fa-solid fa-triangle-exclamation"></i> คุณได้ทำแบบทดสอบนี้แล้ว</h2>
    <div class="bad" style="margin-top:12px">
      ระบบตรวจพบผลการสอบเดิมในเครื่องนี้ (LocalStorage) — หากต้องการสอบใหม่ ให้ใช้เครื่อง/โปรไฟล์เบราว์เซอร์อื่น
    </div>
    <div class="note" style="margin-top:12px">
      <div><b>ชื่อ-สกุล:</b> <span id="prevName">-</span></div>
      <div><b>คะแนน:</b> <span id="prevScore">-</span></div>
      <div><b>วันที่สอบ:</b> <span id="prevDate">-</span></div>
      <div><b>เวลาที่ใช้:</b> <span id="prevTime">-</span></div>
    </div>
  </div>

  <div class="card card-pad" id="screenExam" style="display:none">
    <h2><i class="fa-solid fa-list-check"></i> ข้อสอบ</h2>
    <div class="sub" id="examSub"></div>
    <div id="questions"></div>

    <div style="margin-top:16px; display:flex; justify-content:center">
      <button class="btn btn-accent" id="btnSubmit"><i class="fa-solid fa-paper-plane"></i> ส่งคำตอบทั้งหมด</button>
    </div>
  </div>

  <div class="card card-pad" id="screenResult" style="display:none">
    <h2><i class="fa-solid fa-square-poll-vertical"></i> ผลการทำแบบทดสอบ</h2>
    <div class="note" style="margin-top:12px">
      <div><b>ผู้สอบ:</b> <span id="rName"></span> | <b>ห้อง:</b> <span id="rRoom"></span> | <b>เลขที่:</b> <span id="rNo"></span></div>
      <div style="margin-top:6px"><b>คะแนน:</b> <span id="rScore" style="font-size:1.4rem; font-weight:700; color:var(--primary)"></span></div>
      <div style="margin-top:6px"><b>ถูก:</b> <span id="rCorrect"></span> | <b>ผิด:</b> <span id="rWrong"></span> | <b>ไม่ตอบ:</b> <span id="rUnanswered"></span></div>
      <div style="margin-top:6px"><b>ใช้เวลา:</b> <span id="rTime"></span></div>
    </div>
  </div>
</div>

<div class="progress" id="progress" style="display:none">
  <div class="pb-title"><i class="fa-solid fa-chart-line"></i> ความคืบหน้า (40 ข้อ)</div>
  <div class="pb" id="pb"></div>
</div>

<div class="toast" id="toast"></div>

<div class="lock" id="lock">
  <div class="box">
    <h3><i class="fa-solid fa-ban"></i> ตรวจพบการออกจากโหมดคุมสอบ</h3>
    <p>ระบบตรวจพบว่าออกจากเต็มหน้าจอ/สลับแท็บ/เสียโฟกัส ระหว่างทำข้อสอบ</p>
    <p class="mini">ระบบจะ <b>พักการสอบ</b> (หยุดจับเวลา) และให้กลับเข้าสู่โหมดเต็มหน้าจอก่อนจึงทำต่อได้</p>
    <p class="mini" id="lockMsg">เหตุผล: -</p>
    <div style="margin-top:12px; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap">
      <button class="btn btn-primary" id="lockResume"><i class="fa-solid fa-expand"></i> กลับเข้าสู่เต็มหน้าจอและทำต่อ</button>
      <button class="btn btn-accent" id="lockClose"><i class="fa-solid fa-check"></i> ปิดหน้าต่าง</button>
    </div>
  </div>
</div>

<script>
/* =========================
   CONFIG
========================= */
const STORAGE_KEY = "robot_exam_v3_once";
const IP_KEY = "robot_exam_v3_ip"; // added for reset
const TOTAL_TIME = 40 * 60; // 40 นาที (วินาที)
const DRAW_COUNT = 40;      // สุ่ม 40 จาก 100


// =========================
// Google Sheets (บันทึกคะแนน)
// 1) สร้าง Google Apps Script Web App (ดูโค้ดตัวอย่างที่ให้)
// 2) นำ URL ที่ Deploy แล้วมาใส่ในตัวแปรนี้
// =========================
const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbxDbUGVc-nbqYy8vYi-bxKUWUIqYyPQTAS304OpM3QOEFIJPTf9WmhojD9gSkIKVA/exec";

function toB64Utf8(str){
  // base64(utf8) แบบไม่เพี้ยนภาษาไทย
  return btoa(unescape(encodeURIComponent(str)));
}

async function sendScoreToGoogleSheet(result){
  if (!SHEET_API_URL) return { ok:false, error:"Missing_SHEET_API_URL" };

  const payload = { action:"saveScore", ...result };
  const p = toB64Utf8(JSON.stringify(payload));

  // ✅ ส่งแบบ Image beacon (GET) กัน CORS 100%
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => resolve({ ok:true, sent:true });
    img.onerror = () => resolve({ ok:false, sent:false });

    img.src = `${SHEET_API_URL}?action=saveScore&p=${encodeURIComponent(p)}&t=${Date.now()}`;
  });
}


// คลังข้อสอบ 100 ข้อ (คำตอบถูกซ่อนไว้เป็น Base64 ของเลข index 0-3)
const questionBank = [
  {
    "id": 1,
    "question": "องค์ประกอบใดของหุ่นยนต์เกี่ยวข้องกับการรับข้อมูลจากสภาพแวดล้อมผ่านเซนเซอร์",
    "options": [
      "Perception (การรับรู้)",
      "Cognition (การเข้าใจ)",
      "Manipulation (การเคลื่อนไหว)",
      "Data Logging (การบันทึกข้อมูล)"
    ],
    "correct": "MA=="
  },
  {
    "id": 2,
    "question": "องค์ประกอบใดของหุ่นยนต์เกี่ยวข้องกับการคิด วิเคราะห์ และตัดสินใจจากข้อมูลที่รับมา",
    "options": [
      "Perception (การรับรู้)",
      "Cognition (การเข้าใจ)",
      "Manipulation (การเคลื่อนไหว)",
      "Power Supply (แหล่งจ่ายไฟ)"
    ],
    "correct": "MQ=="
  },
  {
    "id": 3,
    "question": "องค์ประกอบใดของหุ่นยนต์เกี่ยวข้องกับการขยับ แขนกล หรือการทำงานของกลไก",
    "options": [
      "Cognition (การเข้าใจ)",
      "Manipulation (การเคลื่อนไหว)",
      "Perception (การรับรู้)",
      "Compilation (การคอมไพล์)"
    ],
    "correct": "MQ=="
  },
  {
    "id": 4,
    "question": "ข้อใดเป็นตัวอย่างของส่วนที่อยู่ในกลุ่ม Perception มากที่สุด",
    "options": [
      "เซนเซอร์ตรวจจับระยะทาง",
      "มอเตอร์ DC",
      "เกียร์ทด",
      "แบตเตอรี่"
    ],
    "correct": "MA=="
  },
  {
    "id": 5,
    "question": "ข้อใดเป็นตัวอย่างของส่วนที่อยู่ในกลุ่ม Manipulation มากที่สุด",
    "options": [
      "เซนเซอร์แสง",
      "ไมโครโฟน",
      "เซอร์โวมอเตอร์",
      "เซนเซอร์อุณหภูมิ"
    ],
    "correct": "Mg=="
  },
  {
    "id": 6,
    "question": "ข้อใดอธิบายความสัมพันธ์ที่ถูกต้องระหว่าง Perception และ Cognition",
    "options": [
      "Perception รับข้อมูล ส่วน Cognition วิเคราะห์/ตัดสินใจ",
      "Perception สั่งมอเตอร์ ส่วน Cognition อ่านเซนเซอร์",
      "ทั้งสองทำหน้าที่เหมือนกัน",
      "Cognition ทำงานก่อน Perception เสมอ"
    ],
    "correct": "MA=="
  },
  {
    "id": 7,
    "question": "ในระบบหุ่นยนต์ หากต้องการ “รู้ว่าเกิดอะไรขึ้นรอบตัว” ขั้นตอนแรกมักเริ่มที่ส่วนใด",
    "options": [
      "Manipulation",
      "Perception",
      "Cognition",
      "Actuator Driver"
    ],
    "correct": "MQ=="
  },
  {
    "id": 8,
    "question": "ข้อใดเป็นเหตุผลที่ต้องมี Cognition ในหุ่นยนต์",
    "options": [
      "เพื่อเพิ่มแรงบิดมอเตอร์",
      "เพื่อเลือกการกระทำตามข้อมูลที่ตรวจจับ",
      "เพื่อจ่ายไฟให้บอร์ด",
      "เพื่อทำให้เซนเซอร์วัดค่าได้แม่นยำขึ้นโดยอัตโนมัติ"
    ],
    "correct": "MQ=="
  },
  {
    "id": 9,
    "question": "ข้อใดเป็นเหตุผลที่ต้องมี Perception ในหุ่นยนต์",
    "options": [
      "เพื่อให้หุ่นยนต์รับรู้สภาพแวดล้อม",
      "เพื่อให้หุ่นยนต์หมุนล้อได้",
      "เพื่อให้หุ่นยนต์ติดตั้ง Node.js ได้",
      "เพื่อให้หุ่นยนต์สร้างกราฟได้"
    ],
    "correct": "MA=="
  },
  {
    "id": 10,
    "question": "ข้อใดอธิบาย “หุ่นยนต์” ได้เหมาะสมที่สุด",
    "options": [
      "เครื่องจักรที่ทำงานตามกลไกอย่างเดียวโดยไม่มีการรับรู้",
      "ระบบที่รับรู้ ตัดสินใจ และกระทำต่อสภาพแวดล้อมได้",
      "โปรแกรมคอมพิวเตอร์ที่ไม่มีฮาร์ดแวร์",
      "อุปกรณ์ที่ต้องเชื่อมต่ออินเทอร์เน็ตตลอดเวลา"
    ],
    "correct": "MQ=="
  },
  {
    "id": 11,
    "question": "ข้อใดจัดเป็นลำดับการทำงานแบบพื้นฐานของหุ่นยนต์ได้เหมาะสมที่สุด",
    "options": [
      "Manipulation → Cognition → Perception",
      "Perception → Cognition → Manipulation",
      "Cognition → Manipulation → Perception",
      "Perception → Manipulation → Cognition"
    ],
    "correct": "MQ=="
  },
  {
    "id": 12,
    "question": "ข้อใดเป็นตัวอย่างสถานการณ์ที่ต้องใช้ทั้ง Perception และ Manipulation",
    "options": [
      "อ่านค่าจากเซนเซอร์อย่างเดียว",
      "บันทึกข้อมูลลงไฟล์อย่างเดียว",
      "ตรวจจับสิ่งกีดขวางแล้วหยุด/เลี้ยว",
      "เปิดหน้าเว็บอย่างเดียว"
    ],
    "correct": "Mg=="
  },
  {
    "id": 13,
    "question": "เมื่อหุ่นยนต์ “ตรวจพบ” วัตถุในระยะใกล้ คำว่า “ตรวจพบ” เกี่ยวข้องกับองค์ประกอบใดมากที่สุด",
    "options": [
      "Perception",
      "Manipulation",
      "Power",
      "Storage"
    ],
    "correct": "MA=="
  },
  {
    "id": 14,
    "question": "เมื่อหุ่นยนต์ “ตัดสินใจ” ว่าจะเลี้ยวซ้ายหรือขวา คำว่า “ตัดสินใจ” เกี่ยวข้องกับองค์ประกอบใดมากที่สุด",
    "options": [
      "Perception",
      "Cognition",
      "Manipulation",
      "Sensor Shield"
    ],
    "correct": "MQ=="
  },
  {
    "id": 15,
    "question": "เมื่อหุ่นยนต์ “เลี้ยว” หรือ “ขยับ” คำว่า “ขยับ” เกี่ยวข้องกับองค์ประกอบใดมากที่สุด",
    "options": [
      "Cognition",
      "Perception",
      "Manipulation",
      "IDE"
    ],
    "correct": "Mg=="
  },
  {
    "id": 16,
    "question": "ข้อใดเป็นการจับคู่ที่ถูกต้อง",
    "options": [
      "Perception = เซนเซอร์, Cognition = ตัดสินใจ, Manipulation = มอเตอร์/กลไก",
      "Perception = มอเตอร์, Cognition = เซนเซอร์, Manipulation = ตัดสินใจ",
      "Perception = แบตเตอรี่, Cognition = มอเตอร์, Manipulation = เซนเซอร์",
      "Perception = อินเทอร์เน็ต, Cognition = Wi‑Fi, Manipulation = Bluetooth"
    ],
    "correct": "MA=="
  },
  {
    "id": 17,
    "question": "หากต้องการให้หุ่นยนต์ “เข้าใจ” สัญญาณจากเซนเซอร์และแปลงเป็นคำสั่งควบคุมมอเตอร์ ส่วนใดทำหน้าที่หลัก",
    "options": [
      "Perception",
      "Cognition",
      "Manipulation",
      "Charging"
    ],
    "correct": "MQ=="
  },
  {
    "id": 18,
    "question": "ข้อใดเป็นตัวอย่างที่แสดงบทบาทของ Cognition ชัดที่สุด",
    "options": [
      "อ่านค่าอุณหภูมิ",
      "สั่งมอเตอร์หมุน",
      "เปรียบเทียบค่าระยะกับเกณฑ์แล้วตัดสินใจหยุด",
      "จ่ายไฟ 5V ให้บอร์ด"
    ],
    "correct": "Mg=="
  },
  {
    "id": 19,
    "question": "ข้อใดเป็นตัวอย่างที่แสดงบทบาทของ Manipulation ชัดที่สุด",
    "options": [
      "คำนวณค่าความเร็วที่เหมาะสม",
      "สั่งแขนกลยกวัตถุ",
      "อ่านค่าเซนเซอร์แสง",
      "วิเคราะห์ข้อมูล"
    ],
    "correct": "MQ=="
  },
  {
    "id": 20,
    "question": "ข้อใดเป็นตัวอย่างที่แสดงบทบาทของ Perception ชัดที่สุด",
    "options": [
      "เซนเซอร์ส่งค่าระยะไปยังบอร์ด",
      "บอร์ดเลือกแผนการเดิน",
      "มอเตอร์หมุนล้อ",
      "กำหนดเส้นทางการเคลื่อนที่"
    ],
    "correct": "MA=="
  },
  {
    "id": 21,
    "question": "องค์ประกอบ Perception มักให้ผลลัพธ์ในรูปแบบใดมากที่สุด",
    "options": [
      "ข้อมูล/ค่าที่วัดได้",
      "แรงบิด",
      "การหมุนของล้อ",
      "ความจุแบตเตอรี่"
    ],
    "correct": "MA=="
  },
  {
    "id": 22,
    "question": "องค์ประกอบ Manipulation มักส่งผลลัพธ์ในรูปแบบใดมากที่สุด",
    "options": [
      "ค่าจากเซนเซอร์",
      "การเคลื่อนที่หรือการกระทำทางกายภาพ",
      "ตัวอักษรในโค้ด",
      "ชื่อโดเมนเว็บ"
    ],
    "correct": "MQ=="
  },
  {
    "id": 23,
    "question": "องค์ประกอบ Cognition มักทำหน้าที่ใดมากที่สุด",
    "options": [
      "ประมวลผลและกำหนดการกระทำ",
      "วัดค่าทางกายภาพ",
      "เป็นแหล่งจ่ายพลังงาน",
      "เป็นโครงสร้างทางกล"
    ],
    "correct": "MA=="
  },
  {
    "id": 24,
    "question": "ข้อใดไม่ใช่ตัวอย่างของ Manipulation",
    "options": [
      "ล้อหมุนเคลื่อนที่",
      "แขนกลยกวัตถุ",
      "อ่านค่าระยะด้วยเซนเซอร์",
      "เซอร์โวหมุนตามองศา"
    ],
    "correct": "Mg=="
  },
  {
    "id": 25,
    "question": "ข้อใดไม่ใช่ตัวอย่างของ Perception",
    "options": [
      "เซนเซอร์ความชื้น",
      "เซนเซอร์อุณหภูมิ",
      "บอร์ดวิเคราะห์ค่าที่วัดได้",
      "เซนเซอร์แสง"
    ],
    "correct": "Mg=="
  },
  {
    "id": 26,
    "question": "ซอฟต์แวร์ใดถูกกล่าวถึงว่า “Run JavaScript Everywhere”",
    "options": [
      "Node.js",
      "Node-RED",
      "Wokwi",
      "DHT"
    ],
    "correct": "MA=="
  },
  {
    "id": 27,
    "question": "Node-RED ถูกใช้ในบริบทของการทำงานแบบใดมากที่สุด",
    "options": [
      "เขียนโค้ดภาษา C อย่างเดียว",
      "สร้างโฟลว์เพื่อเชื่อมอุปกรณ์และข้อมูล",
      "ออกแบบชิ้นส่วนเครื่องกล",
      "จัดการไฟล์เอกสาร"
    ],
    "correct": "MQ=="
  },
  {
    "id": 28,
    "question": "หากต้องติดตั้ง Node-RED บนคอมพิวเตอร์ มักต้องติดตั้งอะไรเป็นพื้นฐานก่อน",
    "options": [
      "Node.js",
      "Wokwi",
      "DHT Sensor",
      "ESP-NOW"
    ],
    "correct": "MA=="
  },
  {
    "id": 29,
    "question": "แพลตฟอร์มจำลองที่มีตัวอย่างโปรเจกต์ออนไลน์ถูกระบุด้วยโดเมนใด",
    "options": [
      "wokwi.com",
      "nodejs.org",
      "github.com",
      "arduino.cc"
    ],
    "correct": "MA=="
  },
  {
    "id": 30,
    "question": "ข้อความ “DHT Sensor with ESP || Display Reading on Node-RED” สื่อถึงงานลักษณะใด",
    "options": [
      "อ่านค่าจากเซนเซอร์แล้วแสดงผลบน Node-RED",
      "สั่งมอเตอร์ให้หมุนด้วย Node.js",
      "เชื่อมต่อ ESP-NOW เพื่อส่งคำสั่ง",
      "ออกแบบกฎระเบียบห้องเรียน"
    ],
    "correct": "MA=="
  },
  {
    "id": 31,
    "question": "DHT Sensor มักใช้วัดค่ากลุ่มใดมากที่สุด",
    "options": [
      "อุณหภูมิและความชื้น",
      "ระยะทางและความเร็ว",
      "แรงดันและกระแส",
      "พิกัด GPS"
    ],
    "correct": "MA=="
  },
  {
    "id": 32,
    "question": "ถ้าต้องการ “แสดงค่าเซนเซอร์” บน Node-RED ข้อมูลต้องถูกส่งเข้ามาใน Node-RED จากที่ใด",
    "options": [
      "จากอุปกรณ์/บอร์ดที่อ่านค่าเซนเซอร์",
      "จากโปรแกรม Paint",
      "จากเครื่องพิมพ์",
      "จาก BIOS"
    ],
    "correct": "MA=="
  },
  {
    "id": 33,
    "question": "ข้อใดอธิบายบทบาทของ Node-RED ได้เหมาะสมที่สุด",
    "options": [
      "ตัวจำลองวงจร",
      "เครื่องมือสร้างการไหลของข้อมูลและการเชื่อมต่อ",
      "เซนเซอร์วัดค่า",
      "ไดรเวอร์มอเตอร์"
    ],
    "correct": "MQ=="
  },
  {
    "id": 34,
    "question": "หากต้องการทำงาน IoT โดยเชื่อมอุปกรณ์กับ Node-RED อุปกรณ์ที่ถูกกล่าวถึงร่วมกันบ่อยที่สุดคือข้อใด",
    "options": [
      "ESP32",
      "Arduino UNO อย่างเดียว",
      "Raspberry Pi Pico อย่างเดียว",
      "PLC อย่างเดียว"
    ],
    "correct": "MA=="
  },
  {
    "id": 35,
    "question": "คำว่า IoTs ในสไลด์สื่อถึงสิ่งใดมากที่สุด",
    "options": [
      "อุปกรณ์ที่เชื่อมต่อและแลกเปลี่ยนข้อมูล",
      "โปรแกรมตัดต่อวิดีโอ",
      "เกมออนไลน์",
      "ระบบปฏิบัติการมือถือ"
    ],
    "correct": "MA=="
  },
  {
    "id": 36,
    "question": "ข้อใดเป็นลำดับที่เหมาะสมที่สุดในการเริ่มใช้งาน Node-RED บนเครื่องคอมพิวเตอร์",
    "options": [
      "ติดตั้ง Node-RED ก่อน แล้วค่อยติดตั้ง Node.js",
      "ติดตั้ง Node.js ก่อน แล้วค่อยติดตั้ง Node-RED",
      "เปิด Wokwi ก่อน แล้วค่อยติดตั้ง Node.js",
      "ติดตั้ง DHT ก่อน แล้วค่อยติดตั้ง Node-RED"
    ],
    "correct": "MQ=="
  },
  {
    "id": 37,
    "question": "ข้อใดเกี่ยวข้องกับ “การติดตั้งโปรแกรม” โดยตรงมากที่สุด",
    "options": [
      "ขั้นตอนการติดตั้ง Node-RED",
      "การเลือกองค์ประกอบของหุ่นยนต์",
      "การสื่อสารสองทางของ ESP-NOW",
      "การวัดอุณหภูมิของ DHT"
    ],
    "correct": "MA=="
  },
  {
    "id": 38,
    "question": "โดเมน nodejs.org เกี่ยวข้องกับสิ่งใดมากที่สุด",
    "options": [
      "เว็บไซต์ของ Node.js",
      "เว็บไซต์ของ Node-RED",
      "เว็บไซต์ของ ESP-NOW",
      "เว็บไซต์ของ DHT"
    ],
    "correct": "MA=="
  },
  {
    "id": 39,
    "question": "หากต้องการทดลองตัวอย่างออนไลน์โดยไม่ติดตั้งโปรแกรมในเครื่อง ตัวเลือกใดเหมาะสมที่สุด",
    "options": [
      "ใช้แพลตฟอร์มจำลองออนไลน์",
      "ถอดสายไฟทั้งหมด",
      "ปิดอินเทอร์เน็ต",
      "ลบไดรเวอร์การ์ดจอ"
    ],
    "correct": "MA=="
  },
  {
    "id": 40,
    "question": "ข้อใดเป็นเหตุผลที่นิยมใช้ Node-RED ในงาน IoT",
    "options": [
      "ช่วยเชื่อมข้อมูลและอุปกรณ์ได้สะดวก",
      "ทำให้มอเตอร์แรงขึ้นโดยตรง",
      "ทำให้เซนเซอร์ไม่ต้องใช้ไฟ",
      "ทำให้ไม่ต้องเขียนโปรแกรมใด ๆ เลย"
    ],
    "correct": "MA=="
  },
  {
    "id": 41,
    "question": "ข้อความ “Display Reading” หมายถึงการทำสิ่งใด",
    "options": [
      "แสดงค่าที่อ่านได้",
      "ลบค่าที่อ่านได้",
      "แปลงค่าที่อ่านได้เป็นเสียง",
      "ซ่อนค่าที่อ่านได้"
    ],
    "correct": "MA=="
  },
  {
    "id": 42,
    "question": "ข้อใดเป็นตัวอย่าง “ข้อมูลเซนเซอร์” ที่เหมาะสมที่สุด",
    "options": [
      "อุณหภูมิ 28°C",
      "ชื่อโดเมน",
      "เลขเวอร์ชันโปรแกรม",
      "สีของไอคอน"
    ],
    "correct": "MA=="
  },
  {
    "id": 43,
    "question": "ข้อใดเป็นการจับคู่ที่ถูกต้องเกี่ยวกับเครื่องมือ/แพลตฟอร์ม",
    "options": [
      "Node.js = รัน JavaScript, Node-RED = สร้างโฟลว์, Wokwi = จำลองออนไลน์",
      "Node.js = จำลองออนไลน์, Node-RED = เซนเซอร์, Wokwi = รัน JavaScript",
      "Node.js = เซนเซอร์, Node-RED = มอเตอร์, Wokwi = แหล่งจ่ายไฟ",
      "Node.js = Wi‑Fi, Node-RED = Bluetooth, Wokwi = GPS"
    ],
    "correct": "MA=="
  },
  {
    "id": 44,
    "question": "หากต้องการให้ ESP ส่งค่าจาก DHT ไปยัง Node-RED สิ่งสำคัญที่สุดคือข้อใด",
    "options": [
      "ต้องมีช่องทางส่งข้อมูลจากบอร์ดไปยัง Node-RED",
      "ต้องเพิ่มแรงดันแบตเตอรี่",
      "ต้องเพิ่มจำนวนมอเตอร์",
      "ต้องลบโปรแกรมในบอร์ด"
    ],
    "correct": "MA=="
  },
  {
    "id": 45,
    "question": "คำว่า “โปรเจกต์” ในบริบทของ Wokwi มักหมายถึงสิ่งใด",
    "options": [
      "งานตัวอย่างที่พร้อมทดลอง/ปรับแก้",
      "ไฟล์รูปภาพอย่างเดียว",
      "แบบฟอร์มลงชื่อ",
      "ตารางคะแนนกีฬา"
    ],
    "correct": "MA=="
  },
  {
    "id": 46,
    "question": "ข้อใดสื่อถึงการทำงานแบบ “แสดงผลบน Node-RED” ได้ชัดที่สุด",
    "options": [
      "ส่งค่าจากเซนเซอร์ไปยัง Node-RED แล้วดูบนหน้าจอ",
      "หมุนมอเตอร์โดยไม่อ่านค่าใด ๆ",
      "บันทึกคะแนนลงสมุด",
      "เปิดเว็บดูวิดีโอ"
    ],
    "correct": "MA=="
  },
  {
    "id": 47,
    "question": "ข้อใดเป็นองค์ประกอบที่ “ไม่จำเป็นโดยตรง” ต่อการอ่านค่า DHT",
    "options": [
      "สายสัญญาณ/การเชื่อมต่อ",
      "บอร์ดไมโครคอนโทรลเลอร์",
      "เซนเซอร์ DHT",
      "ปุ่ม Print Screen"
    ],
    "correct": "Mw=="
  },
  {
    "id": 48,
    "question": "ข้อใดเป็นตัวอย่างงาน IoT ที่สอดคล้องกับแนวคิดในสไลด์",
    "options": [
      "อ่านค่าเซนเซอร์แล้วส่งไปแสดงผล/ควบคุมผ่านระบบ",
      "วาดรูปในสมุด",
      "เล่นเกมออฟไลน์",
      "พิมพ์งานโดยไม่ใช้ข้อมูล"
    ],
    "correct": "MA=="
  },
  {
    "id": 49,
    "question": "Node-RED มักถูกนำมาใช้เพื่อทำหน้าที่ใดในระบบ",
    "options": [
      "รับ/จัดการ/แสดงข้อมูลจากอุปกรณ์",
      "เพิ่มความจุแบตเตอรี่",
      "เปลี่ยนชนิดเซนเซอร์ให้เป็นมอเตอร์",
      "ทำให้สายไฟสั้นลง"
    ],
    "correct": "MA=="
  },
  {
    "id": 50,
    "question": "ข้อความในสไลด์ระบุว่าเรียนรู้และควบคุม IoTs อุปกรณ์ด้วยอะไร",
    "options": [
      "Node-RED ร่วมกับ ESP32",
      "เฉพาะภาษา Python",
      "เฉพาะ Excel",
      "เฉพาะ Bluetooth เท่านั้น"
    ],
    "correct": "MA=="
  },
  {
    "id": 51,
    "question": "ข้อใดเป็นตัวอย่างสิ่งที่มักใช้ร่วมกับ Node-RED ในงาน IoT ตามสไลด์",
    "options": [
      "ESP32",
      "ไมโครโฟนไร้สายอย่างเดียว",
      "เครื่องพิมพ์เลเซอร์อย่างเดียว",
      "โปรเจกเตอร์ 4K อย่างเดียว"
    ],
    "correct": "MA=="
  },
  {
    "id": 52,
    "question": "คำว่า “with ESP32” บ่งชี้ความสัมพันธ์แบบใด",
    "options": [
      "Node-RED ทำงานร่วมกับบอร์ด ESP32",
      "Node-RED แทนที่ ESP32 ได้ทั้งหมด",
      "ESP32 ไม่เกี่ยวข้องกับระบบ",
      "ESP32 ใช้ได้เฉพาะกับมอเตอร์"
    ],
    "correct": "MA=="
  },
  {
    "id": 53,
    "question": "ข้อใดเป็นแนวคิดที่สอดคล้องกับ “แสดงค่าเซนเซอร์บน Node-RED” มากที่สุด",
    "options": [
      "มีข้อมูลไหลจากอุปกรณ์ → Node-RED → แสดงผล",
      "มีข้อมูลไหลจาก Node-RED → เซนเซอร์ → อุปกรณ์",
      "ข้อมูลอยู่ในเครื่องพิมพ์เท่านั้น",
      "ข้อมูลอยู่ในหน่วยความจำ BIOS เท่านั้น"
    ],
    "correct": "MA=="
  },
  {
    "id": 54,
    "question": "ถ้าต้องการเปิดโปรเจกต์ตัวอย่าง Wokwi สิ่งที่ต้องใช้โดยตรงคือข้อใด",
    "options": [
      "เว็บเบราว์เซอร์",
      "โปรแกรมตัดต่อเสียง",
      "เกมเอนจิน",
      "แอปแผนที่"
    ],
    "correct": "MA=="
  },
  {
    "id": 55,
    "question": "ข้อใดเป็นการใช้งานที่เหมาะสมของ Node.js ในบริบทที่กล่าวถึง",
    "options": [
      "เป็นพื้นฐานให้โปรแกรมอื่นทำงานได้",
      "เป็นเซนเซอร์วัดอุณหภูมิ",
      "เป็นมอเตอร์ขับเคลื่อน",
      "เป็นเกียร์ทด"
    ],
    "correct": "MA=="
  },
  {
    "id": 56,
    "question": "คำว่า “ติดตั้งโปรแกรม” ในสไลด์เกี่ยวข้องกับงานประเภทใด",
    "options": [
      "ซอฟต์แวร์",
      "เครื่องกล",
      "เคมี",
      "ศิลปะ"
    ],
    "correct": "MA=="
  },
  {
    "id": 57,
    "question": "การทำโปรเจกต์ “DHT Sensor with ESP” ต้องมีอุปกรณ์กลุ่มใดอย่างน้อย",
    "options": [
      "บอร์ด + เซนเซอร์",
      "เกียร์ + โซ่",
      "ลำโพง + ไมโครโฟน",
      "จอ 4K + โปรเจกเตอร์"
    ],
    "correct": "MA=="
  },
  {
    "id": 58,
    "question": "หากต้องการให้ Node-RED แสดงค่าได้ต่อเนื่อง สิ่งใดสำคัญที่สุด",
    "options": [
      "การส่งข้อมูลเข้ามาอย่างต่อเนื่อง",
      "การเพิ่มสีธีมหน้าเว็บ",
      "การเปลี่ยนฟอนต์",
      "การซ่อนปุ่มเมนู"
    ],
    "correct": "MA=="
  },
  {
    "id": 59,
    "question": "ESP-NOW ถูกกล่าวถึงว่าเหมาะกับงานลักษณะใดมากที่สุด",
    "options": [
      "ควบคุมอุปกรณ์หลายตัวจากตัวหลัก",
      "ตัดต่อวิดีโอความละเอียดสูง",
      "พิมพ์เอกสารจำนวนมาก",
      "เล่นเกมออนไลน์"
    ],
    "correct": "MA=="
  },
  {
    "id": 60,
    "question": "แนวคิด “master ส่งข้อมูลไปหลาย slave” สื่อถึงโครงสร้างแบบใด",
    "options": [
      "หนึ่งต่อหลาย (one-to-many)",
      "หลายต่อหนึ่ง (many-to-one)",
      "หนึ่งต่อหนึ่งเท่านั้น",
      "ไม่สามารถส่งข้อมูลได้"
    ],
    "correct": "MA=="
  },
  {
    "id": 61,
    "question": "ในคำอธิบาย มีการใช้คำว่า ตัวหลัก/ตัวรอง เพื่อให้เข้าใจง่าย แทนคำใดมากที่สุด",
    "options": [
      "master/slave",
      "client/server",
      "publisher/subscriber",
      "encoder/decoder"
    ],
    "correct": "MA=="
  },
  {
    "id": 62,
    "question": "ESP-NOW ถูกกล่าวถึงว่าสามารถสื่อสารได้แบบใด",
    "options": [
      "สองทาง (ส่งและรับได้)",
      "ทางเดียวเท่านั้น",
      "รับได้อย่างเดียว",
      "ส่งได้อย่างเดียว"
    ],
    "correct": "MA=="
  },
  {
    "id": 63,
    "question": "ข้อใดสอดคล้องกับคำอธิบาย “บอร์ดสองตัวคุยกันและแลกเปลี่ยนข้อมูลกันได้โดยตรง”",
    "options": [
      "การสื่อสารสองทาง",
      "การสื่อสารแบบอ่านอย่างเดียว",
      "การสื่อสารผ่านเครื่องพิมพ์",
      "การสื่อสารผ่านสาย HDMI"
    ],
    "correct": "MA=="
  },
  {
    "id": 64,
    "question": "ESP32 ในบริบทของ ESP-NOW สามารถเพิ่มบอร์ดหลายตัวเพื่อทำอะไรได้",
    "options": [
      "ให้สื่อสารกันเหมือนเครือข่ายและแลกเปลี่ยนข้อมูลกันได้",
      "ให้เพิ่มแรงดันไฟอัตโนมัติ",
      "ให้เพิ่มความละเอียดหน้าจอ",
      "ให้ปิดการใช้งาน Wi‑Fi ทั้งหมด"
    ],
    "correct": "MA=="
  },
  {
    "id": 65,
    "question": "ข้อใดเป็นการใช้งานที่ยกตัวอย่างไว้สำหรับโครงสร้างตัวหลักตัวเดียว",
    "options": [
      "ควบคุมอุปกรณ์หลายตัวในบ้าน",
      "ทำบัญชีรายรับรายจ่าย",
      "ตัดต่อเพลง",
      "สตรีมภาพยนตร์"
    ],
    "correct": "MA=="
  },
  {
    "id": 66,
    "question": "คำว่า “ตัวส่ง” และ “ตัวรับ” ในการอธิบาย ESP-NOW สอดคล้องกับการทำงานใด",
    "options": [
      "การส่งข้อมูลและการรับข้อมูล",
      "การชาร์จแบตเตอรี่",
      "การพิมพ์งาน",
      "การบีบอัดไฟล์"
    ],
    "correct": "MA=="
  },
  {
    "id": 67,
    "question": "ข้อใดเป็นข้อดีของการมี “หลายตัวรับ” เมื่อมีตัวส่งตัวเดียว",
    "options": [
      "ส่งคำสั่งไปหลายอุปกรณ์ได้",
      "ทำให้มอเตอร์ทุกตัวแรงขึ้น",
      "ทำให้เซนเซอร์วัดค่าได้เร็วขึ้นโดยไม่ต้องประมวลผล",
      "ทำให้บอร์ดไม่ต้องใช้ไฟ"
    ],
    "correct": "MA=="
  },
  {
    "id": 68,
    "question": "ในคำอธิบาย ตัวหลักสามารถส่งคำสั่งแบบใดไปยังแต่ละตัวรองได้",
    "options": [
      "คำสั่งเดียวกันหรือแตกต่างกัน",
      "เฉพาะคำสั่งเดียวกันเท่านั้น",
      "เฉพาะคำสั่งแตกต่างกันเท่านั้น",
      "ส่งไม่ได้"
    ],
    "correct": "MA=="
  },
  {
    "id": 69,
    "question": "ข้อใดสรุปคุณสมบัติของ ESP-NOW ที่กล่าวถึงได้ถูกต้องที่สุด",
    "options": [
      "บอร์ดสามารถส่งและรับข้อมูลได้ และขยายจำนวนบอร์ดได้",
      "บอร์ดส่งได้อย่างเดียวและเพิ่มบอร์ดไม่ได้",
      "บอร์ดรับได้อย่างเดียวและต้องมีสาย LAN",
      "บอร์ดต้องใช้งานร่วมกับจอภาพเท่านั้น"
    ],
    "correct": "MA=="
  },
  {
    "id": 70,
    "question": "ข้อใดเป็นคำอธิบายที่เหมาะสมที่สุดของคำว่า “เครือข่าย” ในบริบทที่กล่าวถึง",
    "options": [
      "บอร์ดหลายตัวเชื่อมต่อและแลกเปลี่ยนข้อมูลกัน",
      "สายไฟหลายเส้นมัดรวมกัน",
      "ไฟบ้าน 220V",
      "การพิมพ์เอกสารร่วมกัน"
    ],
    "correct": "MA=="
  },
  {
    "id": 71,
    "question": "หากต้องการให้หลายบอร์ดสื่อสารกันตามแนวคิดที่กล่าวถึง สิ่งสำคัญที่สุดคือข้อใด",
    "options": [
      "ต้องกำหนดให้บอร์ดสามารถส่ง/รับข้อมูลได้",
      "ต้องเพิ่มความจอ 4K",
      "ต้องเพิ่ม RAM คอมพิวเตอร์",
      "ต้องลบแอปเบราว์เซอร์"
    ],
    "correct": "MA=="
  },
  {
    "id": 72,
    "question": "ข้อใดไม่สอดคล้องกับคำอธิบาย ESP-NOW ที่กล่าวถึง",
    "options": [
      "บอร์ดสามารถสื่อสารสองทาง",
      "ตัวหลักส่งไปหลายตัวรองได้",
      "บอร์ดแลกเปลี่ยนข้อมูลกันได้โดยตรง",
      "จำเป็นต้องใช้โปรแกรมตารางคำนวณเพื่อสื่อสาร"
    ],
    "correct": "Mw=="
  },
  {
    "id": 73,
    "question": "การเรียกบอร์ดว่า “ตัวหลัก” ในคำอธิบาย มักหมายถึงบทบาทใด",
    "options": [
      "ส่งข้อมูล/สั่งงานเป็นหลัก",
      "รับข้อมูลอย่างเดียว",
      "ทำหน้าที่เป็นเซนเซอร์อย่างเดียว",
      "ทำหน้าที่เป็นมอเตอร์อย่างเดียว"
    ],
    "correct": "MA=="
  },
  {
    "id": 74,
    "question": "การเรียกบอร์ดว่า “ตัวรอง” ในคำอธิบาย มักหมายถึงบทบาทใด",
    "options": [
      "รับข้อมูล/ทำตามคำสั่ง",
      "เป็นแหล่งจ่ายไฟให้ทุกตัว",
      "เป็นคอมพิวเตอร์แม่ข่าย",
      "เป็นหน้าจอแสดงผลอย่างเดียว"
    ],
    "correct": "MA=="
  },
  {
    "id": 75,
    "question": "ข้อใดเป็นตัวอย่างสถานการณ์ที่เข้ากับแนวคิด “รีโมทควบคุม” ที่กล่าวถึง",
    "options": [
      "ตัวหลักส่งคำสั่งเปิด/ปิดให้อุปกรณ์หลายจุด",
      "บันทึกเสียงลงโทรศัพท์",
      "พิมพ์รายงาน",
      "ดูหนังออนไลน์"
    ],
    "correct": "MA=="
  },
  {
    "id": 76,
    "question": "คำว่า “แลกเปลี่ยนข้อมูลกันได้” สื่อถึงความสามารถใด",
    "options": [
      "แต่ละบอร์ดส่งและรับข้อมูลได้",
      "บอร์ดส่งได้อย่างเดียว",
      "บอร์ดรับได้อย่างเดียว",
      "บอร์ดทำงานได้เฉพาะออฟไลน์ไม่ส่งข้อมูล"
    ],
    "correct": "MA=="
  },
  {
    "id": 77,
    "question": "ข้อใดอธิบายความต่างของ “ส่งทางเดียว” กับ “สองทาง” ได้ถูกต้องที่สุด",
    "options": [
      "ทางเดียว = ส่งหรือรับด้านเดียว, สองทาง = ส่งและรับได้",
      "ทางเดียว = ส่งและรับได้, สองทาง = ส่งอย่างเดียว",
      "ทั้งสองเหมือนกัน",
      "สองทางต้องใช้สาย HDMI"
    ],
    "correct": "MA=="
  },
  {
    "id": 78,
    "question": "หากต้องการออกแบบระบบที่มีบอร์ดหลายตัวสื่อสารกัน “เหมือนเป็นเครือข่าย” แนวคิดที่กล่าวถึงเหมาะกับข้อใด",
    "options": [
      "เพิ่มบอร์ดเพื่อเชื่อมต่อและแลกเปลี่ยนข้อมูลกัน",
      "ลดจำนวนบอร์ดให้เหลือ 1 ตัวเสมอ",
      "ปิดการส่งข้อมูลทั้งหมด",
      "ใช้โปรเจกเตอร์แทนบอร์ด"
    ],
    "correct": "MA=="
  },
  {
    "id": 79,
    "question": "ข้อใดเป็นการสรุปภาพรวมของระบบ IoT ที่กล่าวถึงได้เหมาะสมที่สุด",
    "options": [
      "อุปกรณ์อ่านค่า/ควบคุม แล้วส่งข้อมูลให้ระบบแสดงผลหรือจัดการ",
      "อุปกรณ์ต้องเป็นคอมพิวเตอร์ตั้งโต๊ะทั้งหมด",
      "อุปกรณ์ทำงานได้เฉพาะแบบไม่ใช้ข้อมูล",
      "อุปกรณ์ต้องใช้โปรแกรมเอกสารเท่านั้น"
    ],
    "correct": "MA=="
  },
  {
    "id": 80,
    "question": "ในแนวคิดการทำงานร่วมกันระหว่าง ESP32 และ Node-RED สิ่งใดทำหน้าที่เป็น “อุปกรณ์ปลายทาง” มากที่สุด",
    "options": [
      "ESP32",
      "Node-RED",
      "nodejs.org",
      "wokwi.com"
    ],
    "correct": "MA=="
  },
  {
    "id": 81,
    "question": "หากต้องการทดสอบโค้ดหรือวงจรแบบรวดเร็วผ่านตัวอย่างออนไลน์ ตัวเลือกใดเหมาะสมที่สุด",
    "options": [
      "ใช้โปรเจกต์บน Wokwi",
      "ใช้โปรแกรมพิมพ์เอกสาร",
      "ใช้โปรแกรมวาดรูป",
      "ใช้โปรแกรมเล่นเพลง"
    ],
    "correct": "MA=="
  },
  {
    "id": 82,
    "question": "ข้อใดเป็นเหตุผลที่คำว่า MAC Address ปรากฏในเนื้อหา ESP-NOW",
    "options": [
      "ใช้ระบุอุปกรณ์เพื่อการสื่อสาร",
      "ใช้คำนวณอุณหภูมิ",
      "ใช้แทนชื่อ Wi‑Fi",
      "ใช้แทนแรงดันไฟ"
    ],
    "correct": "MA=="
  },
  {
    "id": 83,
    "question": "หากต้องการให้บอร์ดสองตัว “รู้จักกัน” ในระบบสื่อสารแบบตรง สิ่งที่มักต้องใช้คือข้อใด",
    "options": [
      "ตัวระบุอุปกรณ์ (เช่น MAC Address)",
      "ความละเอียดหน้าจอ",
      "สีของธีม",
      "จำนวนฟอนต์"
    ],
    "correct": "MA=="
  },
  {
    "id": 84,
    "question": "คำว่า “สั่งงาน” ในบริบทของตัวหลัก/ตัวรอง มักหมายถึงการทำสิ่งใด",
    "options": [
      "ส่งข้อมูลคำสั่งไปให้อีกบอร์ดทำตาม",
      "เพิ่มกระแสไฟให้บอร์ด",
      "คัดลอกไฟล์ในคอมพิวเตอร์",
      "ติดตั้งไดรเวอร์การ์ดเสียง"
    ],
    "correct": "MA=="
  },
  {
    "id": 85,
    "question": "ข้อใดเป็นตัวอย่าง “ข้อมูล” ที่เหมาะจะส่งระหว่างบอร์ดตามแนวคิดที่กล่าวถึง",
    "options": [
      "สถานะ เปิด/ปิด",
      "ความยาวสาย USB",
      "ชื่อผู้ใช้ในระบบ",
      "สีพื้นหลังเว็บ"
    ],
    "correct": "MA=="
  },
  {
    "id": 86,
    "question": "หากต้องการให้หลายบอร์ดทำงานร่วมกันแบบควบคุมเป็นกลุ่ม ข้อใดเหมาะสมที่สุด",
    "options": [
      "กำหนดให้มีตัวหลักส่งคำสั่งไปหลายตัวรอง",
      "ให้ทุกตัวทำงานโดยไม่รับคำสั่ง",
      "ให้ตัดการสื่อสารทั้งหมด",
      "ให้ใช้เครื่องพิมพ์เป็นตัวกลาง"
    ],
    "correct": "MA=="
  },
  {
    "id": 87,
    "question": "ข้อใดเป็นตัวอย่างของ “ระบบควบคุมระยะไกล” ตามแนวคิดที่ยกไว้",
    "options": [
      "ควบคุมไฟ/อุปกรณ์ในบ้านจากตัวหลัก",
      "วาดภาพบนกระดาษ",
      "เล่นดนตรี",
      "อ่านหนังสือ"
    ],
    "correct": "MA=="
  },
  {
    "id": 88,
    "question": "ข้อใดเป็นการใช้คำที่เหมาะสมและเป็นกลาง แทนคำที่อาจอ่อนไหวในบางบริบท",
    "options": [
      "ตัวหลัก/ตัวรอง",
      "ถูก/ผิด",
      "เร็ว/ช้า",
      "สูง/ต่ำ"
    ],
    "correct": "MA=="
  },
  {
    "id": 89,
    "question": "ในระบบที่บอร์ด “สื่อสารสองทาง” ข้อใดเป็นตัวอย่างที่สอดคล้องที่สุด",
    "options": [
      "A ส่งค่าไป B และ B ส่งการตอบกลับไป A",
      "A ส่งค่าไป B เท่านั้น",
      "B รับค่าอย่างเดียวตลอด",
      "ไม่มีการส่งข้อมูลใด ๆ"
    ],
    "correct": "MA=="
  },
  {
    "id": 90,
    "question": "ข้อใดเป็นเหตุผลที่การสื่อสารสองทางมีประโยชน์",
    "options": [
      "ช่วยให้ยืนยันผลหรือสถานะตอบกลับได้",
      "ทำให้แบตเตอรี่ชาร์จเร็วขึ้น",
      "ทำให้หน้าจอใหญ่ขึ้น",
      "ทำให้คีย์บอร์ดพิมพ์เร็วขึ้น"
    ],
    "correct": "MA=="
  },
  {
    "id": 91,
    "question": "หากต้องการแสดงผลค่าจากเซนเซอร์บน Node-RED ข้อใดเป็นสิ่งที่ต้องมีแน่นอน",
    "options": [
      "ค่าที่อ่านได้จากเซนเซอร์",
      "เครื่องพิมพ์",
      "โปรเจกเตอร์",
      "เกมออนไลน์"
    ],
    "correct": "MA=="
  },
  {
    "id": 92,
    "question": "ข้อใดเป็นตัวอย่างหัวข้อที่อยู่ในกลุ่ม “การติดตั้ง” ตามเนื้อหา",
    "options": [
      "การติดตั้ง Node.js และ Node-RED",
      "การเลือกสีพื้นหลังเว็บ",
      "การตั้งรหัสผ่าน Wi‑Fi ของโรงเรียน",
      "การตั้งค่าปริ้นเตอร์"
    ],
    "correct": "MA=="
  },
  {
    "id": 93,
    "question": "ถ้าต้องการเริ่มต้นทำงานกับ Node-RED แต่ยังไม่พร้อมติดตั้งในเครื่อง ควรเริ่มด้วยอะไร",
    "options": [
      "ทดลองตัวอย่างในแพลตฟอร์มออนไลน์",
      "เปลี่ยนสายไฟทั้งหมด",
      "อัปเกรดจอภาพก่อน",
      "ติดตั้งโปรแกรมตัดต่อวิดีโอก่อน"
    ],
    "correct": "MA=="
  },
  {
    "id": 94,
    "question": "ข้อใดเป็นคำอธิบายที่เหมาะสมของคำว่า “Flow” ในบริบท Node-RED",
    "options": [
      "ลำดับการเชื่อมต่อการทำงานของโหนด/ข้อมูล",
      "ชนิดของเซนเซอร์",
      "ชนิดของมอเตอร์",
      "ชนิดของแบตเตอรี่"
    ],
    "correct": "MA=="
  },
  {
    "id": 95,
    "question": "ข้อใดเป็นสิ่งที่ Node-RED ช่วยให้ทำได้ง่ายขึ้น",
    "options": [
      "เชื่อมอุปกรณ์และข้อมูลเข้าด้วยกัน",
      "เพิ่มแรงบิดมอเตอร์โดยตรง",
      "ทำให้เซนเซอร์ไม่ต้องต่อสาย",
      "ทำให้บอร์ดไม่ต้องเขียนโค้ดใด ๆ เลยในทุกกรณี"
    ],
    "correct": "MA=="
  },
  {
    "id": 96,
    "question": "ข้อใดเป็นการจับคู่ที่ถูกต้องเกี่ยวกับงานที่ยกตัวอย่าง",
    "options": [
      "DHT + ESP = อ่านค่า, Node-RED = แสดงผล",
      "DHT + ESP = แสดงผล, Node-RED = อ่านค่า",
      "Node.js = เซนเซอร์, Wokwi = แหล่งจ่ายไฟ",
      "ESP-NOW = โปรแกรมออกแบบกราฟิก"
    ],
    "correct": "MA=="
  },
  {
    "id": 97,
    "question": "ข้อใดเป็นเหตุผลที่ “ตัวอย่างโปรเจกต์” ช่วยในการเรียนรู้ระบบได้ดี",
    "options": [
      "เห็นภาพการเชื่อมต่อและผลลัพธ์ได้รวดเร็ว",
      "ทำให้ไม่ต้องใช้ไฟฟ้า",
      "ทำให้ไม่ต้องมีอุปกรณ์ใด ๆ เลย",
      "ทำให้ไม่ต้องมีเวลาในการทดลอง"
    ],
    "correct": "MA=="
  },
  {
    "id": 98,
    "question": "ข้อใดสะท้อนแนวคิด “ขยายระบบได้” ตามเนื้อหา ESP-NOW มากที่สุด",
    "options": [
      "เพิ่มจำนวนบอร์ดเพื่อให้สื่อสารกันได้หลายตัว",
      "ลดจำนวนบอร์ดให้เหลือศูนย์",
      "ใช้บอร์ดตัวเดียวแทนทุกอย่าง",
      "ปิดการสื่อสารทุกชนิด"
    ],
    "correct": "MA=="
  },
  {
    "id": 99,
    "question": "ข้อใดเป็นสรุปที่เหมาะสมของบทบาท “การสื่อสาร” ในระบบหุ่นยนต์/IoT ที่กล่าวถึง",
    "options": [
      "ทำให้อุปกรณ์แลกเปลี่ยนข้อมูลและควบคุมกันได้",
      "ทำให้มอเตอร์หมุนโดยไม่ต้องจ่ายไฟ",
      "ทำให้เซนเซอร์วัดค่าได้โดยไม่ต้องต่อ",
      "ทำให้โปรแกรมไม่ต้องมีเงื่อนไขใด ๆ"
    ],
    "correct": "MA=="
  },
  {
    "id": 100,
    "question": "ตัวย่อใดถูกกล่าวถึงร่วมกับคำว่า “Broker”",
    "options": [
      "MQTT",
      "GPS",
      "PWM",
      "I2C"
    ],
    "correct": "MA=="
  }
];

function decodeAnswer(b64) {
  try {
    return parseInt(atob(b64), 10);
  } catch (e) {
    return NaN;
  }
}

/* =========================
   UI Helpers
========================= */
const $ = (id) => document.getElementById(id);

function toast(msg, type="info") {
  const t = $("toast");
  t.textContent = msg;
  t.className = `toast ${type}`;
  t.style.display = "block";
  setTimeout(()=> t.style.display="none", 2600);
}

function formatTime(sec) {
  const h = Math.floor(sec/3600);
  const m = Math.floor((sec%3600)/60);
  const s = sec%60;
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function shuffle(arr) {
  const a = [...arr];
  for (let i=a.length-1;i>0;i--) {
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/* =========================
   Exam State
========================= */
let examStarted = false;
let examFinished = false;
let timeLeft = TOTAL_TIME;
let timerHandle = null;
let startAt = null;

let drawnQuestions = []; // 40 ข้อที่สุ่มมา
let answers = [];        // user selected (0-3) or null
let currentIndex = 0;

let paused = false;
let pauseReason = "";
let graceUntil = 0; // กันตรวจจับผิดพลาดช่วงเปลี่ยนโหมด

function pauseExam(reason="") {
  if (Date.now() < graceUntil) return;
  if (paused || !examStarted || examFinished) return;
  paused = true;
  pauseReason = reason || "";
  stopTimer();
  const lock = $("lock");
  lock.style.display = "flex";
  const msg = $("lockMsg");
  if (msg) {
    msg.textContent = pauseReason
      ? `เหตุผล: ${pauseReason.replace(/_/g,' ')}`
      : "เหตุผล: ไม่ระบุ";
  }
  toast("พักการสอบ: กรุณากลับเข้าสู่โหมดเต็มหน้าจอ", "warn");
}

async function resumeExam() {
  if (!paused || !examStarted || examFinished) return;
  try { await requestFullScreen(); } catch(e) {}
  if (!document.fullscreenElement) {
    toast("ยังไม่อยู่ในโหมดเต็มหน้าจอ", "bad");
    return;
  }
  paused = false;
  pauseReason = "";
  graceUntil = Date.now() + 2000; // ผ่อนผัน 2 วินาทีแรก
  $("lock").style.display = "none";
  startTimer();
  toast("กลับมาทำข้อสอบต่อได้แล้ว", "ok");
}

function getStoredResult() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return null;
  try { return JSON.parse(raw); } catch { return null; }
}

function showAlready(res) {
  $("screenStart").style.display = "none";
  $("screenAlready").style.display = "block";
  $("prevName").textContent = `${res.firstName||""} ${res.lastName||""}`.trim() || "-";
  $("prevScore").textContent = `${res.score||0}/${res.total||DRAW_COUNT}`;
  $("prevDate").textContent = res.submitDate || "-";
  $("prevTime").textContent = res.timeUsed || "-";
}

function updateTimerUI() {
  $("timerText").textContent = formatTime(timeLeft);
  const timer = $("timer");
  timer.classList.remove("pulse-warn","pulse-bad");
  if (timeLeft <= 60) timer.classList.add("pulse-bad");
  else if (timeLeft <= 5*60) timer.classList.add("pulse-warn");
}

function startTimer() {
  updateTimerUI();
  timerHandle = setInterval(()=>{
    if (!paused) {
      timeLeft--;
      updateTimerUI();
    } else {
      updateTimerUI();
      return;
    }
    if (timeLeft <= 0) {
      clearInterval(timerHandle);
      toast("หมดเวลา! ระบบจะส่งข้อสอบอัตโนมัติ", "warn");
      submitExam("timeout");
    }
  }, 1000);
}

function stopTimer() {
  if (timerHandle) clearInterval(timerHandle);
  timerHandle = null;
}

function requestFullScreen() {
  const el = document.documentElement;
  if (el.requestFullscreen) return el.requestFullscreen();
  if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
  if (el.msRequestFullscreen) return el.msRequestFullscreen();
  return Promise.resolve();
}

/* =========================
   Lockdown / Proctoring-ish
   (Best effort within browser limits)
========================= */
function hardBlockKeys(e) {
  const key = (e.key || "").toLowerCase();
  const ctrl = e.ctrlKey || e.metaKey;
  const shift = e.shiftKey;

  // Block devtools / view-source / refresh / print / save / fullscreen toggles
  const blocked =
    key === "f11" ||
    key === "f12" ||
    (ctrl && shift && (key === "i" || key === "j" || key === "c")) ||
    (ctrl && (key === "u" || key === "s" || key === "p" || key === "r")) ||
    key === "printscreen";

  if (blocked) {
    e.preventDefault();
    e.stopPropagation();
    toast("โหมดคุมสอบ: คำสั่งนี้ถูกบล็อก", "warn");
    return false;
  }

  // Block tab switching keys (best effort)
  if (key === "tab" && examStarted && !examFinished) {
    e.preventDefault();
    e.stopPropagation();
    toast("โหมดคุมสอบ: ห้ามกด Tab", "warn");
    return false;
  }
}

function triggerViolation(reason) {
  if (!examStarted || examFinished) return;
  console.warn("Violation:", reason);
  pauseExam(reason);
}

function proctorAttach() {
  document.addEventListener("contextmenu", (e)=>{ e.preventDefault(); toast("โหมดคุมสอบ: ปิดคลิกขวา", "warn"); });
  document.addEventListener("keydown", hardBlockKeys, true);

  // Detect focus/visibility changes
  document.addEventListener("visibilitychange", ()=> {
  if (!examStarted || examFinished) return;
  if (Date.now() < graceUntil) return;
  if (document.hidden) {
    setTimeout(()=>{
      if (document.hidden) pauseExam("tab_hidden");
    }, 200);
  }
}, true);

  // Detect fullscreen exit
  document.addEventListener("fullscreenchange", ()=> {
    if (examStarted && !examFinished && !document.fullscreenElement) {
      if (Date.now() < graceUntil) return;
      pauseExam("exit_fullscreen");
    }
  }, true);

  // Attempt to block print (Ctrl+P already); also block beforeprint
  window.addEventListener("beforeprint", (e)=> {
    if (examStarted && !examFinished) {
      e.preventDefault();
      triggerViolation("print_attempt");
    }
  }, true);

  // Prevent leaving page during exam
  window.addEventListener("beforeunload", (e)=> {
    if (examStarted && !examFinished) {
      e.preventDefault();
      e.returnValue = "กำลังทำข้อสอบอยู่";
      return "กำลังทำข้อสอบอยู่";
    }
  });
}

/* =========================
   Render
========================= */
function renderProgress() {
  const pb = $("pb");
  pb.innerHTML = "";
  for (let i=0;i<drawnQuestions.length;i++) {
    const b = document.createElement("button");
    b.textContent = (i+1);
    b.addEventListener("click", ()=> scrollTo(i));
    pb.appendChild(b);
  }
  updateProgress();
}

function updateProgress() {
  const btns = $("pb").querySelectorAll("button");
  btns.forEach((b,i)=> {
    b.classList.toggle("answered", answers[i] !== null);
    b.classList.toggle("current", i === currentIndex);
  });
}

function scrollTo(i) {
  currentIndex = i;
  const el = document.getElementById("q-" + i);
  if (el) el.scrollIntoView({behavior:"smooth", block:"start"});
  updateProgress();
}

function renderQuestions() {
  const wrap = $("questions");
  wrap.innerHTML = "";

  drawnQuestions.forEach((q, idx)=> {
    const card = document.createElement("div");
    card.className = "qcard";
    card.id = "q-" + idx;

    const title = document.createElement("div");
    title.className = "qtitle";
    title.innerHTML = `<i class="fa-regular fa-circle-question"></i> ข้อที่ ${idx+1}`;

    const qt = document.createElement("div");
    qt.style.marginBottom = "10px";
    qt.style.fontSize = "1.05rem";
    qt.innerHTML = q.question;

    const optWrap = document.createElement("div");
    optWrap.className = "options";

    q.options.forEach((opt, oi)=> {
      const optEl = document.createElement("div");
      optEl.className = "option";
      optEl.innerHTML = opt;

      optEl.addEventListener("click", ()=> {
        // clear
        [...optWrap.querySelectorAll(".option")].forEach(x=> x.classList.remove("selected"));
        optEl.classList.add("selected");
        answers[idx] = oi;
        updateProgress();

        // auto jump a bit
        if (idx < drawnQuestions.length-1) {
          setTimeout(()=> scrollTo(idx+1), 250);
        }
      });

      optWrap.appendChild(optEl);
    });

    card.appendChild(title);
    card.appendChild(qt);
    card.appendChild(optWrap);
    wrap.appendChild(card);
  });
}

/* =========================
   Start / Submit
========================= */
function startExam() {
  // once-per-device
  const prev = getStoredResult();
  if (prev) {
    showAlready(prev);
    toast("เครื่องนี้สอบแล้ว", "bad");
    return;
  }

  const firstName = $("firstName").value.trim();
  const lastName  = $("lastName").value.trim();
  const number    = $("number").value.trim();
  const room      = $("room").value.trim();

  if (!firstName || !lastName || !number || !room) {
    toast("กรุณากรอกข้อมูลให้ครบก่อนเริ่มสอบ", "bad");
    return;
  }

  // draw 40 from 100 (random)
  drawnQuestions = shuffle(questionBank).slice(0, DRAW_COUNT);
  answers = new Array(drawnQuestions.length).fill(null);

  $("screenStart").style.display = "none";
  $("screenExam").style.display = "block";
  $("progress").style.display = "block";
  $("examSub").textContent = `ผู้สอบ: ${firstName} ${lastName} | ห้อง: ${room} | เลขที่: ${number}`;

  examStarted = true;
  examFinished = false;
  paused = false;
  pauseReason = "";
  graceUntil = Date.now() + 2000; // ผ่อนผัน 2 วินาทีแรก
  startAt = new Date();
  timeLeft = TOTAL_TIME;

  renderQuestions();
  renderProgress();

  // go fullscreen
  requestFullScreen().catch(()=>{ /* ignored */ });
  startTimer();

  toast("เริ่มทำข้อสอบแล้ว (โหมดคุมสอบเปิดใช้งาน)", "info");

  // store student info in window for submit
  window.__student = { firstName, lastName, number, room };
}

function submitExam(reason="manual") {
  if (examFinished) return;

  stopTimer();
  examFinished = true;
  examStarted = false;
  paused = false;
  pauseReason = "";
  graceUntil = Date.now() + 2000; // ผ่อนผัน 2 วินาทีแรก
  try { document.getElementById('lock').style.display='none'; } catch(e) {}

  const endAt = new Date();
  const usedSec = startAt ? Math.floor((endAt - startAt)/1000) : (TOTAL_TIME - timeLeft);

  // score
  let correct=0, wrong=0, unanswered=0;
  drawnQuestions.forEach((q, i)=> {
    const a = answers[i];
    const ca = decodeAnswer(q.correct);
    if (a === null) unanswered++;
    else if (a === ca) correct++;
    else wrong++;
  });

  const total = drawnQuestions.length;
  const result = {
    ...window.__student,
    score: correct,
    total,
    correct, wrong, unanswered,
    timeUsed: formatTime(usedSec),
    submitDate: new Date().toLocaleDateString("th-TH"),
    submitTime: new Date().toLocaleTimeString("th-TH"),
    reason
  };

  // save once
  localStorage.setItem(STORAGE_KEY, JSON.stringify(result));


  // ส่งคะแนนไป Google Sheet (ไม่เปลี่ยน UI/โครงข้อสอบ)
  sendScoreToGoogleSheet(result).then((r)=>{
    // เงียบ ๆ ไม่รบกวนการแสดงผล (จะเปิด toast ก็ได้)
    // console.log("Sheet:", r);
  }).catch(()=>{});
  // show
  $("screenExam").style.display = "none";
  $("progress").style.display = "none";
  $("screenResult").style.display = "block";

  $("rName").textContent = `${result.firstName} ${result.lastName}`;
  $("rRoom").textContent = result.room;
  $("rNo").textContent = result.number;
  $("rScore").textContent = `${result.score}/${result.total}`;
  $("rCorrect").textContent = result.correct;
  $("rWrong").textContent = result.wrong;
  $("rUnanswered").textContent = result.unanswered;
  $("rTime").textContent = result.timeUsed;

  toast("บันทึกผลสอบเรียบร้อย", "ok");
}

$("btnStart").addEventListener("click", startExam);
$("btnSubmit").addEventListener("click", ()=> submitExam("manual"));


// On load: show already if exists
document.addEventListener("DOMContentLoaded", ()=> {
  // ===== RESET (สำหรับครู) =====
  // ใส่ ?reset=1 ต่อท้าย URL เพื่อเคลียร์การล็อกเครื่องนี้
  try {
    const sp = new URLSearchParams(location.search);
    if (sp.get("reset") === "1") {
      localStorage.removeItem(STORAGE_KEY);
      localStorage.removeItem(IP_KEY);
      toast("ล้างสถานะการสอบบนเครื่องนี้แล้ว", "ok");
      // remove query
      const clean = location.origin + location.pathname + location.hash;
      setTimeout(()=> location.replace(clean), 600);
      return;
    }
  } catch(e) {}

  proctorAttach();
  const prev = getStoredResult();
  if (prev) showAlready(prev);
});
</script>
</body>
</html>
